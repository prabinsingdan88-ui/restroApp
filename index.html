<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>üçΩÔ∏è RestaurantOS - Complete Restaurant Management System</title>
    
    <!-- Bootstrap CSS -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <!-- Font Awesome -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <!-- Chart.js for analytics -->
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <!-- DataTables for better tables -->
    <link rel="stylesheet" href="https://cdn.datatables.net/1.13.6/css/dataTables.bootstrap5.min.css">
    
    <style>
        :root {
            --primary: #4361ee;
            --secondary: #3f37c9;
            --success: #4cc9f0;
            --danger: #f72585;
            --warning: #f8961e;
            --info: #7209b7;
        }
        
        body {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            min-height: 100vh;
            margin: 0;
            padding: 0;
        }
        
        .main-container {
            background: white;
            min-height: 100vh;
            border-radius: 0;
            box-shadow: 0 0 50px rgba(0,0,0,0.2);
        }
        
        /* Sidebar Navigation */
        .sidebar {
            background: #212529;
            color: white;
            min-height: 100vh;
            padding: 0;
            position: fixed;
            width: 250px;
            z-index: 1000;
        }
        
        .main-content-area {
            margin-left: 250px;
            width: calc(100% - 250px);
        }
        
        @media (max-width: 992px) {
            .sidebar {
                width: 70px;
            }
            .main-content-area {
                margin-left: 70px;
                width: calc(100% - 70px);
            }
            .nav-link span {
                display: none;
            }
        }
        
        .nav-link {
            color: #adb5bd;
            padding: 15px 20px;
            border-left: 4px solid transparent;
            transition: all 0.3s;
            cursor: pointer;
            display: block;
            text-decoration: none;
            white-space: nowrap;
        }
        
        .nav-link:hover, .nav-link.active {
            color: white;
            background: rgba(255,255,255,0.1);
            border-left-color: var(--primary);
        }
        
        .nav-link i {
            width: 25px;
            text-align: center;
            margin-right: 10px;
        }
        
        /* Header */
        .header {
            background: white;
            border-bottom: 1px solid #dee2e6;
            padding: 15px 0;
            position: sticky;
            top: 0;
            z-index: 999;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }
        
        .stat-card {
            background: #f8f9fa;
            border-radius: 10px;
            padding: 15px;
            text-align: center;
            transition: all 0.3s;
            cursor: default;
            border: 1px solid #e9ecef;
        }
        
        .stat-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 10px 20px rgba(0,0,0,0.1);
        }
        
        .stat-value {
            font-size: 2em;
            font-weight: bold;
            color: var(--primary);
        }
        
        /* Main Content */
        .main-content {
            padding: 20px;
            min-height: calc(100vh - 80px);
        }
        
        .section-content {
            display: none;
            animation: fadeIn 0.3s ease;
        }
        
        .section-content.active {
            display: block;
        }
        
        /* POS Styles */
        .pos-container {
            display: grid;
            grid-template-columns: 2fr 1fr;
            gap: 20px;
            height: calc(100vh - 200px);
        }
        
        @media (max-width: 768px) {
            .pos-container {
                grid-template-columns: 1fr;
                height: auto;
            }
        }
        
        .menu-items {
            background: #f8f9fa;
            border-radius: 10px;
            padding: 15px;
            overflow-y: auto;
            border: 2px dashed #dee2e6;
        }
        
        .order-summary {
            background: white;
            border: 2px solid #e9ecef;
            border-radius: 10px;
            padding: 20px;
            box-shadow: 0 5px 15px rgba(0,0,0,0.05);
            position: sticky;
            top: 20px;
        }
        
        .menu-item-card {
            background: white;
            border: 1px solid #dee2e6;
            border-radius: 8px;
            padding: 15px;
            margin-bottom: 15px;
            cursor: pointer;
            transition: all 0.3s;
        }
        
        .menu-item-card:hover {
            background: #e9ecef;
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(0,0,0,0.1);
        }
        
        .menu-item-card.selected {
            background: #e3f2fd;
            border-color: var(--primary);
            box-shadow: 0 0 0 2px rgba(67, 97, 238, 0.2);
        }
        
        .category-tab {
            background: #e9ecef;
            border: none;
            padding: 10px 20px;
            margin-right: 5px;
            border-radius: 20px;
            font-weight: 500;
            transition: all 0.3s;
            cursor: pointer;
        }
        
        .category-tab.active {
            background: var(--primary);
            color: white;
        }
        
        /* Order Items */
        .order-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 10px;
            border-bottom: 1px solid #dee2e6;
            background: #f8f9fa;
            border-radius: 5px;
            margin-bottom: 5px;
        }
        
        .order-item:last-child {
            border-bottom: none;
        }
        
        .quantity-controls {
            display: flex;
            align-items: center;
            gap: 10px;
        }
        
        /* Tables Grid */
        .tables-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(150px, 1fr));
            gap: 15px;
            margin-top: 20px;
        }
        
        .table-card {
            background: white;
            border-radius: 15px;
            padding: 20px;
            text-align: center;
            box-shadow: 0 3px 10px rgba(0,0,0,0.1);
            cursor: pointer;
            transition: all 0.3s;
            border: 3px solid transparent;
            position: relative;
            overflow: hidden;
        }
        
        .table-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 10px 20px rgba(0,0,0,0.15);
        }
        
        .table-card::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            height: 5px;
            background: #28a745;
        }
        
        .table-card.available::before {
            background: #28a745;
        }
        
        .table-card.occupied::before {
            background: #dc3545;
        }
        
        .table-card.reserved::before {
            background: #ffc107;
        }
        
        .table-card.maintenance::before {
            background: #6c757d;
        }
        
        .table-card.available {
            background: linear-gradient(135deg, #d4edda, #c3e6cb);
        }
        
        .table-card.occupied {
            background: linear-gradient(135deg, #f8d7da, #f5c6cb);
        }
        
        .table-card.reserved {
            background: linear-gradient(135deg, #fff3cd, #ffeaa7);
        }
        
        .table-card.maintenance {
            background: linear-gradient(135deg, #e2e3e5, #d6d8db);
        }
        
        /* Orders Table */
        .orders-table {
            background: white;
            border-radius: 10px;
            padding: 20px;
            box-shadow: 0 5px 15px rgba(0,0,0,0.05);
        }
        
        /* Modal Styles */
        .modal-overlay {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(0,0,0,0.5);
            display: none;
            justify-content: center;
            align-items: center;
            z-index: 1100;
            animation: fadeIn 0.3s ease;
        }
        
        .modal-overlay.active {
            display: flex;
        }
        
        .modal-content {
            background: white;
            border-radius: 15px;
            max-width: 800px;
            width: 90%;
            max-height: 90vh;
            overflow-y: auto;
            animation: slideUp 0.3s ease;
        }
        
        /* Button Styles */
        .btn {
            transition: all 0.3s;
        }
        
        .btn:hover {
            transform: translateY(-2px);
        }
        
        /* Animations */
        @keyframes fadeIn {
            from { opacity: 0; }
            to { opacity: 1; }
        }
        
        @keyframes slideUp {
            from { opacity: 0; transform: translateY(20px); }
            to { opacity: 1; transform: translateY(0); }
        }
        
        @keyframes pulse {
            0% { transform: scale(1); }
            50% { transform: scale(1.05); }
            100% { transform: scale(1); }
        }
        
        .pulse {
            animation: pulse 2s infinite;
        }
        
        /* Toast Notifications */
        .toast-container {
            position: fixed;
            top: 20px;
            right: 20px;
            z-index: 1200;
        }
        
        .custom-toast {
            background: white;
            border-radius: 10px;
            padding: 15px 20px;
            margin-bottom: 10px;
            box-shadow: 0 5px 15px rgba(0,0,0,0.1);
            display: flex;
            align-items: center;
            min-width: 300px;
            animation: slideUp 0.3s ease;
        }
        
        .toast-icon {
            font-size: 1.5em;
            margin-right: 15px;
        }
        
        .toast-success .toast-icon {
            color: #28a745;
        }
        
        .toast-error .toast-icon {
            color: #dc3545;
        }
        
        .toast-warning .toast-icon {
            color: #ffc107;
        }
        
        .toast-info .toast-icon {
            color: #17a2b8;
        }
        
        /* Status Badges */
        .status-badge {
            padding: 5px 10px;
            border-radius: 20px;
            font-size: 0.8em;
            font-weight: 600;
        }
        
        .status-pending {
            background: #fff3cd;
            color: #856404;
        }
        
        .status-preparing {
            background: #cce5ff;
            color: #004085;
        }
        
        .status-ready {
            background: #d4edda;
            color: #155724;
        }
        
        .status-served {
            background: #d1ecf1;
            color: #0c5460;
        }
        
        .status-completed {
            background: #d4edda;
            color: #155724;
        }
        
        .status-cancelled {
            background: #f8d7da;
            color: #721c24;
        }
        
        /* Loading Spinner */
        .loading-spinner {
            display: inline-block;
            width: 50px;
            height: 50px;
            border: 3px solid #f3f3f3;
            border-top: 3px solid #3498db;
            border-radius: 50%;
            animation: spin 1s linear infinite;
        }
        
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
        
        /* Responsive Adjustments */
        @media (max-width: 768px) {
            .tables-grid {
                grid-template-columns: repeat(auto-fill, minmax(120px, 1fr));
            }
            
            .stat-value {
                font-size: 1.5em;
            }
            
            .modal-content {
                width: 95%;
                margin: 10px;
            }
        }
        
        /* Print Styles */
        @media print {
            .sidebar, .header, .btn, .modal-overlay {
                display: none !important;
            }
            
            .main-content-area {
                margin: 0 !important;
                width: 100% !important;
            }
            
            .section-content {
                display: block !important;
            }
        }
        
        /* Custom Scrollbar */
        ::-webkit-scrollbar {
            width: 8px;
            height: 8px;
        }
        
        ::-webkit-scrollbar-track {
            background: #f1f1f1;
            border-radius: 10px;
        }
        
        ::-webkit-scrollbar-thumb {
            background: #888;
            border-radius: 10px;
        }
        
        ::-webkit-scrollbar-thumb:hover {
            background: #555;
        }
        
        /* Grid Layouts */
        .grid-container {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 20px;
            margin-bottom: 20px;
        }
        
        .dashboard-card {
            background: white;
            border-radius: 10px;
            padding: 20px;
            box-shadow: 0 3px 10px rgba(0,0,0,0.05);
        }
        
        /* Form Styles */
        .form-group {
            margin-bottom: 1.5rem;
        }
        
        .form-label {
            font-weight: 600;
            margin-bottom: 0.5rem;
            color: #495057;
        }
        
        /* Alert Styles */
        .alert-floating {
            position: fixed;
            bottom: 20px;
            right: 20px;
            z-index: 1050;
            animation: slideUp 0.3s ease;
        }
    </style>
</head>
<body>
    <div class="container-fluid p-0">
        <div class="row g-0">
            <!-- Sidebar -->
            <div class="sidebar">
                <div class="p-4">
                    <h4 class="text-white mb-4 d-flex align-items-center">
                        <i class="fas fa-utensils me-3"></i>
                        <span class="d-none d-lg-inline">RestaurantOS</span>
                    </h4>
                    
                    <div class="nav flex-column">
                        <a class="nav-link active" data-section="dashboard">
                            <i class="fas fa-tachometer-alt"></i>
                            <span>Dashboard</span>
                        </a>
                        <a class="nav-link" data-section="pos">
                            <i class="fas fa-cash-register"></i>
                            <span>POS System</span>
                        </a>
                        <a class="nav-link" data-section="tables">
                            <i class="fas fa-chair"></i>
                            <span>Table Management</span>
                        </a>
                        <a class="nav-link" data-section="orders">
                            <i class="fas fa-clipboard-list"></i>
                            <span>Order Management</span>
                        </a>
                        <a class="nav-link" data-section="menu">
                            <i class="fas fa-book"></i>
                            <span>Menu Management</span>
                        </a>
                        <a class="nav-link" data-section="inventory">
                            <i class="fas fa-box"></i>
                            <span>Inventory</span>
                        </a>
                        <a class="nav-link" data-section="staff">
                            <i class="fas fa-users"></i>
                            <span>Staff Management</span>
                        </a>
                        <a class="nav-link" data-section="customers">
                            <i class="fas fa-user-friends"></i>
                            <span>Customers</span>
                        </a>
                        <a class="nav-link" data-section="reports">
                            <i class="fas fa-chart-bar"></i>
                            <span>Reports & Analytics</span>
                        </a>
                        <a class="nav-link" data-section="settings">
                            <i class="fas fa-cog"></i>
                            <span>Settings</span>
                        </a>
                    </div>
                    
                    <div class="mt-5 pt-4 border-top border-secondary">
                        <small class="text-muted d-none d-lg-block">QUICK ACTIONS</small>
                        <div class="d-flex flex-column gap-2 mt-2">
                            <button class="btn btn-success" onclick="quickAction('newOrder')">
                                <i class="fas fa-plus"></i>
                                <span class="d-none d-lg-inline">New Order</span>
                            </button>
                            <button class="btn btn-warning" onclick="quickAction('quickPayment')">
                                <i class="fas fa-credit-card"></i>
                                <span class="d-none d-lg-inline">Quick Payment</span>
                            </button>
                            <button class="btn btn-info" onclick="quickAction('printReport')">
                                <i class="fas fa-print"></i>
                                <span class="d-none d-lg-inline">Print Report</span>
                            </button>
                        </div>
                    </div>
                    
                    <div class="mt-4 pt-3 border-top border-secondary">
                        <div class="text-center">
                            <small class="text-muted" id="systemTime">00:00:00</small>
                        </div>
                    </div>
                </div>
            </div>
            
            <!-- Main Content Area -->
            <div class="main-content-area">
                <!-- Header -->
                <div class="header">
                    <div class="container-fluid">
                        <div class="row align-items-center">
                            <div class="col-md-6">
                                <h3 class="mb-0" id="sectionTitle">Dashboard</h3>
                                <small class="text-muted" id="currentDate">Loading...</small>
                            </div>
                            <div class="col-md-6">
                                <div class="row text-center">
                                    <div class="col-4">
                                        <div class="stat-card">
                                            <div class="stat-value" id="todayRevenue">$0</div>
                                            <small>Today's Revenue</small>
                                        </div>
                                    </div>
                                    <div class="col-4">
                                        <div class="stat-card">
                                            <div class="stat-value" id="todayOrders">0</div>
                                            <small>Today's Orders</small>
                                        </div>
                                    </div>
                                    <div class="col-4">
                                        <div class="stat-card">
                                            <div class="stat-value" id="activeTables">0/20</div>
                                            <small>Active Tables</small>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
                
                <!-- Toast Container -->
                <div class="toast-container" id="toastContainer"></div>
                
                <!-- Main Content Area -->
                <div class="main-content" id="mainContent">
                    <!-- Dashboard Section -->
                    <div id="dashboardSection" class="section-content active">
                        <div class="row mb-4">
                            <div class="col-12">
                                <h4 class="mb-0">Restaurant Dashboard</h4>
                                <p class="text-muted">Welcome back! Here's what's happening today.</p>
                            </div>
                        </div>
                        
                        <div class="grid-container">
                            <div class="dashboard-card">
                                <h5>Today's Performance</h5>
                                <div class="mt-3">
                                    <canvas id="performanceChart" height="200"></canvas>
                                </div>
                            </div>
                            
                            <div class="dashboard-card">
                                <h5>Quick Stats</h5>
                                <div class="mt-3">
                                    <div class="d-flex justify-content-between mb-2">
                                        <span>Total Customers Today:</span>
                                        <strong id="todayCustomers">0</strong>
                                    </div>
                                    <div class="d-flex justify-content-between mb-2">
                                        <span>Average Order Value:</span>
                                        <strong id="avgOrderValue">$0.00</strong>
                                    </div>
                                    <div class="d-flex justify-content-between mb-2">
                                        <span>Occupancy Rate:</span>
                                        <strong id="occupancyRate">0%</strong>
                                    </div>
                                    <div class="d-flex justify-content-between mb-2">
                                        <span>Top Selling Item:</span>
                                        <strong id="topSellingItem">-</strong>
                                    </div>
                                </div>
                            </div>
                        </div>
                        
                        <div class="row mt-4">
                            <div class="col-md-8">
                                <div class="dashboard-card">
                                    <h5>Recent Orders</h5>
                                    <div class="table-responsive mt-3">
                                        <table class="table table-hover" id="recentOrdersTable">
                                            <thead>
                                                <tr>
                                                    <th>Order #</th>
                                                    <th>Table</th>
                                                    <th>Customer</th>
                                                    <th>Amount</th>
                                                    <th>Status</th>
                                                    <th>Time</th>
                                                </tr>
                                            </thead>
                                            <tbody id="recentOrders">
                                                <!-- Orders will be loaded here -->
                                            </tbody>
                                        </table>
                                    </div>
                                </div>
                            </div>
                            
                            <div class="col-md-4">
                                <div class="dashboard-card">
                                    <h5>Quick Actions</h5>
                                    <div class="mt-3">
                                        <button class="btn btn-primary w-100 mb-2" onclick="showSection('pos')">
                                            <i class="fas fa-plus"></i> New Order
                                        </button>
                                        <button class="btn btn-success w-100 mb-2" onclick="showSection('tables')">
                                            <i class="fas fa-chair"></i> Manage Tables
                                        </button>
                                        <button class="btn btn-info w-100 mb-2" onclick="showSection('orders')">
                                            <i class="fas fa-clipboard-check"></i> View Orders
                                        </button>
                                        <button class="btn btn-warning w-100" onclick="generateDailyReport()">
                                            <i class="fas fa-file-alt"></i> Daily Report
                                        </button>
                                    </div>
                                    
                                    <div class="mt-4">
                                        <h6>System Status</h6>
                                        <div class="alert alert-success py-2">
                                            <i class="fas fa-check-circle me-2"></i>
                                            <span id="systemStatus">All Systems Operational</span>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                    
                    <!-- POS Section -->
                    <div id="posSection" class="section-content">
                        <div class="pos-container">
                            <!-- Menu Items -->
                            <div class="menu-items">
                                <div class="d-flex justify-content-between align-items-center mb-3">
                                    <h4 class="mb-0">Menu Items</h4>
                                    <div class="d-flex gap-2">
                                        <div class="input-group" style="max-width: 300px;">
                                            <input type="text" class="form-control" id="menuSearch" placeholder="Search menu...">
                                            <button class="btn btn-outline-secondary" type="button">
                                                <i class="fas fa-search"></i>
                                            </button>
                                        </div>
                                        <button class="btn btn-outline-success" onclick="showAddItemModal()">
                                            <i class="fas fa-plus"></i>
                                        </button>
                                    </div>
                                </div>
                                
                                <div class="mb-3">
                                    <div class="d-flex flex-wrap gap-2" id="categoryTabs">
                                        <!-- Categories will be loaded here -->
                                    </div>
                                </div>
                                
                                <div class="row" id="menuItemsContainer">
                                    <!-- Menu items will be loaded here -->
                                </div>
                            </div>
                            
                            <!-- Order Summary -->
                            <div class="order-summary">
                                <div class="d-flex justify-content-between align-items-center mb-3">
                                    <h4 class="mb-0">Order Summary</h4>
                                    <span class="badge bg-primary" id="orderCounter">0 items</span>
                                </div>
                                
                                <div class="mb-3">
                                    <label class="form-label">Select Table</label>
                                    <select class="form-select" id="tableSelect">
                                        <option value="">Select Table</option>
                                        <!-- Tables will be populated here -->
                                    </select>
                                </div>
                                
                                <div class="row mb-3">
                                    <div class="col-md-6">
                                        <label class="form-label">Customer Name</label>
                                        <input type="text" class="form-control" id="customerName" placeholder="Enter name">
                                    </div>
                                    <div class="col-md-6">
                                        <label class="form-label">Customer Phone</label>
                                        <input type="tel" class="form-control" id="customerPhone" placeholder="Phone number">
                                    </div>
                                </div>
                                
                                <div class="order-items-container mb-3" style="max-height: 300px; overflow-y: auto;">
                                    <div id="orderItems">
                                        <div class="text-center text-muted py-5">
                                            <i class="fas fa-shopping-cart fa-2x mb-3"></i>
                                            <p>No items added yet</p>
                                            <small>Click on menu items to add them to your order</small>
                                        </div>
                                    </div>
                                </div>
                                
                                <div class="bill-summary border-top pt-3">
                                    <div class="d-flex justify-content-between mb-2">
                                        <span>Subtotal:</span>
                                        <span id="subtotal">$0.00</span>
                                    </div>
                                    <div class="d-flex justify-content-between mb-2">
                                        <span>Tax (<span id="taxRate">10</span>%):</span>
                                        <span id="taxAmount">$0.00</span>
                                    </div>
                                    <div class="d-flex justify-content-between mb-2">
                                        <span>Service Charge (<span id="serviceRate">5</span>%):</span>
                                        <span id="serviceCharge">$0.00</span>
                                    </div>
                                    <div class="d-flex justify-content-between fw-bold fs-5 border-top pt-2">
                                        <span>Total:</span>
                                        <span id="totalAmount">$0.00</span>
                                    </div>
                                </div>
                                
                                <div class="mt-4 d-grid gap-2">
                                    <button class="btn btn-primary btn-lg" onclick="saveOrder()">
                                        <i class="fas fa-save me-2"></i> Save Order
                                    </button>
                                    <button class="btn btn-success btn-lg" onclick="processPayment()">
                                        <i class="fas fa-credit-card me-2"></i> Process Payment
                                    </button>
                                    <button class="btn btn-danger" onclick="clearOrder()">
                                        <i class="fas fa-trash me-2"></i> Clear Order
                                    </button>
                                </div>
                            </div>
                        </div>
                    </div>
                    
                    <!-- Tables Section -->
                    <div id="tablesSection" class="section-content">
                        <div class="row mb-4">
                            <div class="col-md-6">
                                <h4 class="mb-0">Table Management</h4>
                                <p class="text-muted">Manage restaurant tables and reservations</p>
                            </div>
                            <div class="col-md-6 text-end">
                                <button class="btn btn-primary" onclick="addNewTable()">
                                    <i class="fas fa-plus me-2"></i> Add New Table
                                </button>
                                <button class="btn btn-success" onclick="updateAllTables()">
                                    <i class="fas fa-sync me-2"></i> Refresh All
                                </button>
                            </div>
                        </div>
                        
                        <div class="tables-grid" id="tablesGrid">
                            <!-- Tables will be loaded here -->
                        </div>
                        
                        <div class="row mt-4">
                            <div class="col-md-6">
                                <div class="dashboard-card">
                                    <h5>Table Statistics</h5>
                                    <div class="mt-3">
                                        <canvas id="tableStatusChart" height="150"></canvas>
                                    </div>
                                </div>
                            </div>
                            <div class="col-md-6">
                                <div class="dashboard-card">
                                    <h5>Table Actions</h5>
                                    <div class="mt-3">
                                        <div class="mb-3">
                                            <label class="form-label">Select Table</label>
                                            <select class="form-select" id="actionTableSelect">
                                                <option value="">Choose table</option>
                                                <!-- Tables will be populated here -->
                                            </select>
                                        </div>
                                        <div class="mb-3">
                                            <label class="form-label">Action</label>
                                            <select class="form-select" id="tableAction">
                                                <option value="available">Mark as Available</option>
                                                <option value="occupied">Mark as Occupied</option>
                                                <option value="reserved">Mark as Reserved</option>
                                                <option value="maintenance">Mark for Maintenance</option>
                                            </select>
                                        </div>
                                        <div class="mb-3">
                                            <label class="form-label">Customer Name (if applicable)</label>
                                            <input type="text" class="form-control" id="tableCustomer" placeholder="Optional">
                                        </div>
                                        <button class="btn btn-primary w-100" onclick="updateTableStatus()">
                                            <i class="fas fa-sync me-2"></i> Update Status
                                        </button>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                    
                    <!-- Orders Section -->
                    <div id="ordersSection" class="section-content">
                        <div class="row mb-4">
                            <div class="col-md-6">
                                <h4 class="mb-0">Order Management</h4>
                                <p class="text-muted">View and manage all orders</p>
                            </div>
                            <div class="col-md-6">
                                <div class="d-flex gap-2 justify-content-end">
                                    <div class="input-group" style="max-width: 300px;">
                                        <input type="text" class="form-control" id="orderSearch" placeholder="Search orders...">
                                        <button class="btn btn-outline-secondary" type="button">
                                            <i class="fas fa-search"></i>
                                        </button>
                                    </div>
                                    <div class="btn-group">
                                        <button class="btn btn-outline-secondary dropdown-toggle" type="button" data-bs-toggle="dropdown">
                                            Filter
                                        </button>
                                        <ul class="dropdown-menu">
                                            <li><a class="dropdown-item" href="#" onclick="filterOrders('all')">All Orders</a></li>
                                            <li><a class="dropdown-item" href="#" onclick="filterOrders('pending')">Pending</a></li>
                                            <li><a class="dropdown-item" href="#" onclick="filterOrders('preparing')">Preparing</a></li>
                                            <li><a class="dropdown-item" href="#" onclick="filterOrders('ready')">Ready</a></li>
                                            <li><a class="dropdown-item" href="#" onclick="filterOrders('completed')">Completed</a></li>
                                        </ul>
                                    </div>
                                </div>
                            </div>
                        </div>
                        
                        <div class="orders-table">
                            <div class="table-responsive">
                                <table class="table table-hover" id="ordersDataTable">
                                    <thead>
                                        <tr>
                                            <th>Order #</th>
                                            <th>Table</th>
                                            <th>Customer</th>
                                            <th>Items</th>
                                            <th>Total</th>
                                            <th>Status</th>
                                            <th>Time</th>
                                            <th>Actions</th>
                                        </tr>
                                    </thead>
                                    <tbody id="ordersTableBody">
                                        <!-- Orders will be loaded here -->
                                    </tbody>
                                </table>
                            </div>
                        </div>
                        
                        <div class="row mt-4">
                            <div class="col-md-3">
                                <div class="dashboard-card text-center">
                                    <h2 class="text-warning" id="pendingCount">0</h2>
                                    <small>Pending Orders</small>
                                </div>
                            </div>
                            <div class="col-md-3">
                                <div class="dashboard-card text-center">
                                    <h2 class="text-info" id="preparingCount">0</h2>
                                    <small>Preparing</small>
                                </div>
                            </div>
                            <div class="col-md-3">
                                <div class="dashboard-card text-center">
                                    <h2 class="text-primary" id="readyCount">0</h2>
                                    <small>Ready to Serve</small>
                                </div>
                            </div>
                            <div class="col-md-3">
                                <div class="dashboard-card text-center">
                                    <h2 class="text-success" id="completedCount">0</h2>
                                    <small>Completed</small>
                                </div>
                            </div>
                        </div>
                    </div>
                    
                    <!-- Menu Section -->
                    <div id="menuSection" class="section-content">
                        <div class="row mb-4">
                            <div class="col-md-6">
                                <h4 class="mb-0">Menu Management</h4>
                                <p class="text-muted">Manage restaurant menu items</p>
                            </div>
                            <div class="col-md-6 text-end">
                                <button class="btn btn-success" onclick="showAddItemModal()">
                                    <i class="fas fa-plus me-2"></i> Add New Item
                                </button>
                                <button class="btn btn-primary" onclick="exportMenu()">
                                    <i class="fas fa-download me-2"></i> Export Menu
                                </button>
                            </div>
                        </div>
                        
                        <div class="dashboard-card">
                            <div class="row mb-3">
                                <div class="col-md-4">
                                    <input type="text" class="form-control" id="searchMenuItems" placeholder="Search menu items...">
                                </div>
                                <div class="col-md-4">
                                    <select class="form-select" id="menuCategoryFilter">
                                        <option value="">All Categories</option>
                                        <option value="Appetizers">Appetizers</option>
                                        <option value="Main Course">Main Course</option>
                                        <option value="Pizza">Pizza</option>
                                        <option value="Burgers">Burgers</option>
                                        <option value="Salads">Salads</option>
                                        <option value="Desserts">Desserts</option>
                                        <option value="Drinks">Drinks</option>
                                        <option value="Specials">Specials</option>
                                    </select>
                                </div>
                                <div class="col-md-4">
                                    <select class="form-select" id="menuSortBy">
                                        <option value="name">Sort by Name</option>
                                        <option value="price">Sort by Price</option>
                                        <option value="category">Sort by Category</option>
                                    </select>
                                </div>
                            </div>
                            
                            <div class="table-responsive">
                                <table class="table table-hover" id="menuManagementTable">
                                    <thead>
                                        <tr>
                                            <th>Image</th>
                                            <th>Name</th>
                                            <th>Category</th>
                                            <th>Price</th>
                                            <th>Cost</th>
                                            <th>Profit</th>
                                            <th>Status</th>
                                            <th>Actions</th>
                                        </tr>
                                    </thead>
                                    <tbody id="menuTableBody">
                                        <!-- Menu items will be loaded here -->
                                    </tbody>
                                </table>
                            </div>
                        </div>
                    </div>
                    
                    <!-- Inventory Section -->
                    <div id="inventorySection" class="section-content">
                        <div class="row mb-4">
                            <div class="col-md-6">
                                <h4 class="mb-0">Inventory Management</h4>
                                <p class="text-muted">Track and manage inventory items</p>
                            </div>
                            <div class="col-md-6 text-end">
                                <button class="btn btn-success" onclick="showAddInventoryItemModal()">
                                    <i class="fas fa-plus me-2"></i> Add Item
                                </button>
                                <button class="btn btn-warning" onclick="showReorderModal()">
                                    <i class="fas fa-shopping-cart me-2"></i> Reorder Items
                                </button>
                            </div>
                        </div>
                        
                        <div class="grid-container">
                            <div class="dashboard-card">
                                <h5>Low Stock Alert</h5>
                                <div class="mt-3" id="lowStockItems">
                                    <!-- Low stock items will be loaded here -->
                                </div>
                            </div>
                            
                            <div class="dashboard-card">
                                <h5>Inventory Summary</h5>
                                <div class="mt-3">
                                    <div class="d-flex justify-content-between mb-2">
                                        <span>Total Items:</span>
                                        <strong id="totalInventoryItems">0</strong>
                                    </div>
                                    <div class="d-flex justify-content-between mb-2">
                                        <span>Low Stock:</span>
                                        <strong class="text-warning" id="lowStockCount">0</strong>
                                    </div>
                                    <div class="d-flex justify-content-between mb-2">
                                        <span>Out of Stock:</span>
                                        <strong class="text-danger" id="outOfStockCount">0</strong>
                                    </div>
                                    <div class="d-flex justify-content-between mb-2">
                                        <span>Inventory Value:</span>
                                        <strong id="inventoryValue">$0.00</strong>
                                    </div>
                                </div>
                            </div>
                        </div>
                        
                        <div class="dashboard-card mt-4">
                            <div class="table-responsive">
                                <table class="table table-hover" id="inventoryTable">
                                    <thead>
                                        <tr>
                                            <th>Item</th>
                                            <th>Category</th>
                                            <th>Current Stock</th>
                                            <th>Min Stock</th>
                                            <th>Unit</th>
                                            <th>Cost/Unit</th>
                                            <th>Total Value</th>
                                            <th>Status</th>
                                            <th>Actions</th>
                                        </tr>
                                    </thead>
                                    <tbody id="inventoryTableBody">
                                        <!-- Inventory items will be loaded here -->
                                    </tbody>
                                </table>
                            </div>
                        </div>
                    </div>
                    
                    <!-- Staff Section -->
                    <div id="staffSection" class="section-content">
                        <div class="row mb-4">
                            <div class="col-md-6">
                                <h4 class="mb-0">Staff Management</h4>
                                <p class="text-muted">Manage restaurant staff and shifts</p>
                            </div>
                            <div class="col-md-6 text-end">
                                <button class="btn btn-success" onclick="showAddStaffModal()">
                                    <i class="fas fa-user-plus me-2"></i> Add Staff
                                </button>
                                <button class="btn btn-primary" onclick="showScheduleModal()">
                                    <i class="fas fa-calendar me-2"></i> View Schedule
                                </button>
                            </div>
                        </div>
                        
                        <div class="grid-container">
                            <div class="dashboard-card">
                                <h5>Today's Shift</h5>
                                <div class="mt-3" id="todayShift">
                                    <!-- Today's shift will be loaded here -->
                                </div>
                            </div>
                            
                            <div class="dashboard-card">
                                <h5>Staff Statistics</h5>
                                <div class="mt-3">
                                    <div class="d-flex justify-content-between mb-2">
                                        <span>Total Staff:</span>
                                        <strong id="totalStaffCount">0</strong>
                                    </div>
                                    <div class="d-flex justify-content-between mb-2">
                                        <span>Active Today:</span>
                                        <strong id="activeStaffCount">0</strong>
                                    </div>
                                    <div class="d-flex justify-content-between mb-2">
                                        <span>On Leave:</span>
                                        <strong id="onLeaveCount">0</strong>
                                    </div>
                                    <div class="d-flex justify-content-between mb-2">
                                        <span>Average Rating:</span>
                                        <strong id="averageRating">0.0</strong>
                                    </div>
                                </div>
                            </div>
                        </div>
                        
                        <div class="dashboard-card mt-4">
                            <div class="table-responsive">
                                <table class="table table-hover" id="staffTable">
                                    <thead>
                                        <tr>
                                            <th>Name</th>
                                            <th>Role</th>
                                            <th>Contact</th>
                                            <th>Shift</th>
                                            <th>Status</th>
                                            <th>Rating</th>
                                            <th>Actions</th>
                                        </tr>
                                    </thead>
                                    <tbody id="staffTableBody">
                                        <!-- Staff members will be loaded here -->
                                    </tbody>
                                </table>
                            </div>
                        </div>
                    </div>
                    
                    <!-- Customers Section -->
                    <div id="customersSection" class="section-content">
                        <div class="row mb-4">
                            <div class="col-md-6">
                                <h4 class="mb-0">Customer Management</h4>
                                <p class="text-muted">Manage customer database and loyalty program</p>
                            </div>
                            <div class="col-md-6 text-end">
                                <button class="btn btn-success" onclick="showAddCustomerModal()">
                                    <i class="fas fa-user-plus me-2"></i> Add Customer
                                </button>
                                <button class="btn btn-primary" onclick="exportCustomers()">
                                    <i class="fas fa-download me-2"></i> Export List
                                </button>
                            </div>
                        </div>
                        
                        <div class="grid-container">
                            <div class="dashboard-card">
                                <h5>Top Customers</h5>
                                <div class="mt-3" id="topCustomers">
                                    <!-- Top customers will be loaded here -->
                                </div>
                            </div>
                            
                            <div class="dashboard-card">
                                <h5>Customer Statistics</h5>
                                <div class="mt-3">
                                    <div class="d-flex justify-content-between mb-2">
                                        <span>Total Customers:</span>
                                        <strong id="totalCustomers">0</strong>
                                    </div>
                                    <div class="d-flex justify-content-between mb-2">
                                        <span>Active This Month:</span>
                                        <strong id="activeCustomers">0</strong>
                                    </div>
                                    <div class="d-flex justify-content-between mb-2">
                                        <span>Loyalty Members:</span>
                                        <strong id="loyaltyMembers">0</strong>
                                    </div>
                                    <div class="d-flex justify-content-between mb-2">
                                        <span>Avg. Visit Frequency:</span>
                                        <strong id="avgVisitFrequency">0 days</strong>
                                    </div>
                                </div>
                            </div>
                        </div>
                        
                        <div class="dashboard-card mt-4">
                            <div class="table-responsive">
                                <table class="table table-hover" id="customersTable">
                                    <thead>
                                        <tr>
                                            <th>Name</th>
                                            <th>Phone</th>
                                            <th>Email</th>
                                            <th>Total Visits</th>
                                            <th>Total Spent</th>
                                            <th>Last Visit</th>
                                            <th>Loyalty Points</th>
                                            <th>Actions</th>
                                        </tr>
                                    </thead>
                                    <tbody id="customersTableBody">
                                        <!-- Customers will be loaded here -->
                                    </tbody>
                                </table>
                            </div>
                        </div>
                    </div>
                    
                    <!-- Reports Section -->
                    <div id="reportsSection" class="section-content">
                        <div class="row mb-4">
                            <div class="col-md-6">
                                <h4 class="mb-0">Reports & Analytics</h4>
                                <p class="text-muted">Detailed reports and business analytics</p>
                            </div>
                            <div class="col-md-6 text-end">
                                <div class="btn-group">
                                    <button class="btn btn-outline-primary" onclick="generateDailyReport()">
                                        Daily Report
                                    </button>
                                    <button class="btn btn-outline-success" onclick="generateWeeklyReport()">
                                        Weekly Report
                                    </button>
                                    <button class="btn btn-outline-info" onclick="generateMonthlyReport()">
                                        Monthly Report
                                    </button>
                                </div>
                            </div>
                        </div>
                        
                        <div class="grid-container">
                            <div class="dashboard-card">
                                <h5>Sales Overview</h5>
                                <div class="mt-3">
                                    <canvas id="salesChart" height="200"></canvas>
                                </div>
                            </div>
                            
                            <div class="dashboard-card">
                                <h5>Top Performing Items</h5>
                                <div class="mt-3">
                                    <canvas id="topItemsChart" height="200"></canvas>
                                </div>
                            </div>
                        </div>
                        
                        <div class="dashboard-card mt-4">
                            <div class="row">
                                <div class="col-md-6">
                                    <h5>Revenue Breakdown</h5>
                                    <div class="mt-3">
                                        <canvas id="revenueChart" height="250"></canvas>
                                    </div>
                                </div>
                                <div class="col-md-6">
                                    <h5>Export Reports</h5>
                                    <div class="mt-3">
                                        <button class="btn btn-primary w-100 mb-2" onclick="exportPDF('daily')">
                                            <i class="fas fa-file-pdf me-2"></i> Export Daily PDF
                                        </button>
                                        <button class="btn btn-success w-100 mb-2" onclick="exportExcel('weekly')">
                                            <i class="fas fa-file-excel me-2"></i> Export Weekly Excel
                                        </button>
                                        <button class="btn btn-info w-100 mb-2" onclick="printSalesReport()">
                                            <i class="fas fa-print me-2"></i> Print Sales Report
                                        </button>
                                        <button class="btn btn-warning w-100" onclick="showDetailedAnalytics()">
                                            <i class="fas fa-chart-line me-2"></i> Detailed Analytics
                                        </button>
                                    </div>
                                    
                                    <div class="mt-4">
                                        <h6>Quick Stats</h6>
                                        <div class="row text-center mt-3">
                                            <div class="col-6">
                                                <div class="h3 text-primary" id="dailySales">$0</div>
                                                <small>Today's Sales</small>
                                            </div>
                                            <div class="col-6">
                                                <div class="h3 text-success" id="weeklyGrowth">0%</div>
                                                <small>Weekly Growth</small>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                    
                    <!-- Settings Section -->
                    <div id="settingsSection" class="section-content">
                        <div class="row mb-4">
                            <div class="col-md-6">
                                <h4 class="mb-0">System Settings</h4>
                                <p class="text-muted">Configure restaurant settings and preferences</p>
                            </div>
                            <div class="col-md-6 text-end">
                                <button class="btn btn-primary" onclick="saveSettings()">
                                    <i class="fas fa-save me-2"></i> Save Settings
                                </button>
                            </div>
                        </div>
                        
                        <div class="dashboard-card">
                            <ul class="nav nav-tabs" id="settingsTabs">
                                <li class="nav-item">
                                    <a class="nav-link active" data-bs-toggle="tab" href="#generalSettings">General</a>
                                </li>
                                <li class="nav-item">
                                    <a class="nav-link" data-bs-toggle="tab" href="#taxSettings">Tax & Charges</a>
                                </li>
                                <li class="nav-item">
                                    <a class="nav-link" data-bs-toggle="tab" href="#printSettings">Print Settings</a>
                                </li>
                                <li class="nav-item">
                                    <a class="nav-link" data-bs-toggle="tab" href="#backupSettings">Backup & Restore</a>
                                </li>
                            </ul>
                            
                            <div class="tab-content mt-4">
                                <div class="tab-pane fade show active" id="generalSettings">
                                    <div class="row">
                                        <div class="col-md-6">
                                            <div class="mb-3">
                                                <label class="form-label">Restaurant Name</label>
                                                <input type="text" class="form-control" id="restaurantName" value="RestaurantOS">
                                            </div>
                                            <div class="mb-3">
                                                <label class="form-label">Currency</label>
                                                <select class="form-select" id="currency">
                                                    <option value="$">USD ($)</option>
                                                    <option value="‚Ç¨">EUR (‚Ç¨)</option>
                                                    <option value="¬£">GBP (¬£)</option>
                                                    <option value="‚Çπ">INR (‚Çπ)</option>
                                                </select>
                                            </div>
                                            <div class="mb-3">
                                                <label class="form-label">Time Zone</label>
                                                <select class="form-select" id="timezone">
                                                    <option value="UTC">UTC</option>
                                                    <option value="EST">Eastern Time</option>
                                                    <option value="PST">Pacific Time</option>
                                                    <option value="IST">Indian Standard Time</option>
                                                </select>
                                            </div>
                                        </div>
                                        <div class="col-md-6">
                                            <div class="mb-3">
                                                <label class="form-label">Default Language</label>
                                                <select class="form-select" id="language">
                                                    <option value="en">English</option>
                                                    <option value="es">Spanish</option>
                                                    <option value="fr">French</option>
                                                    <option value="de">German</option>
                                                </select>
                                            </div>
                                            <div class="mb-3">
                                                <label class="form-label">Date Format</label>
                                                <select class="form-select" id="dateFormat">
                                                    <option value="MM/DD/YYYY">MM/DD/YYYY</option>
                                                    <option value="DD/MM/YYYY">DD/MM/YYYY</option>
                                                    <option value="YYYY-MM-DD">YYYY-MM-DD</option>
                                                </select>
                                            </div>
                                            <div class="mb-3">
                                                <label class="form-label">Auto Logout (minutes)</label>
                                                <input type="number" class="form-control" id="autoLogout" value="30" min="5" max="240">
                                            </div>
                                        </div>
                                    </div>
                                </div>
                                
                                <div class="tab-pane fade" id="taxSettings">
                                    <div class="row">
                                        <div class="col-md-6">
                                            <div class="mb-3">
                                                <label class="form-label">Tax Rate (%)</label>
                                                <input type="number" class="form-control" id="taxRateInput" value="10" step="0.1" min="0" max="50">
                                            </div>
                                            <div class="mb-3">
                                                <label class="form-label">Service Charge (%)</label>
                                                <input type="number" class="form-control" id="serviceChargeInput" value="5" step="0.1" min="0" max="20">
                                            </div>
                                        </div>
                                        <div class="col-md-6">
                                            <div class="mb-3">
                                                <label class="form-label">Enable Tip</label>
                                                <div class="form-check form-switch">
                                                    <input class="form-check-input" type="checkbox" id="enableTip" checked>
                                                    <label class="form-check-label" for="enableTip">Allow tipping</label>
                                                </div>
                                            </div>
                                            <div class="mb-3">
                                                <label class="form-label">Default Tip Percentage</label>
                                                <input type="number" class="form-control" id="defaultTip" value="15" step="1" min="0" max="30" disabled>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                                
                                <div class="tab-pane fade" id="printSettings">
                                    <div class="row">
                                        <div class="col-md-6">
                                            <div class="mb-3">
                                                <label class="form-label">Receipt Header</label>
                                                <textarea class="form-control" id="receiptHeader" rows="3">Thank you for dining with us!</textarea>
                                            </div>
                                            <div class="mb-3">
                                                <label class="form-label">Receipt Footer</label>
                                                <textarea class="form-control" id="receiptFooter" rows="3">Please visit us again!</textarea>
                                            </div>
                                        </div>
                                        <div class="col-md-6">
                                            <div class="mb-3">
                                                <label class="form-label">Print Options</label>
                                                <div class="form-check mb-2">
                                                    <input class="form-check-input" type="checkbox" id="printReceipt" checked>
                                                    <label class="form-check-label" for="printReceipt">Auto-print receipt</label>
                                                </div>
                                                <div class="form-check mb-2">
                                                    <input class="form-check-input" type="checkbox" id="printKitchen" checked>
                                                    <label class="form-check-label" for="printKitchen">Print kitchen order</label>
                                                </div>
                                                <div class="form-check">
                                                    <input class="form-check-input" type="checkbox" id="emailReceipt">
                                                    <label class="form-check-label" for="emailReceipt">Email receipt to customer</label>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                                
                                <div class="tab-pane fade" id="backupSettings">
                                    <div class="row">
                                        <div class="col-md-6">
                                            <div class="mb-3">
                                                <label class="form-label">Auto Backup</label>
                                                <div class="form-check form-switch">
                                                    <input class="form-check-input" type="checkbox" id="autoBackup" checked>
                                                    <label class="form-check-label" for="autoBackup">Enable auto backup</label>
                                                </div>
                                            </div>
                                            <div class="mb-3">
                                                <label class="form-label">Backup Frequency</label>
                                                <select class="form-select" id="backupFrequency">
                                                    <option value="daily">Daily</option>
                                                    <option value="weekly">Weekly</option>
                                                    <option value="monthly">Monthly</option>
                                                </select>
                                            </div>
                                        </div>
                                        <div class="col-md-6">
                                            <div class="mb-4">
                                                <label class="form-label">Data Management</label>
                                                <div class="d-grid gap-2">
                                                    <button class="btn btn-success" onclick="exportAllData()">
                                                        <i class="fas fa-download me-2"></i> Export All Data
                                                    </button>
                                                    <button class="btn btn-warning" onclick="importData()">
                                                        <i class="fas fa-upload me-2"></i> Import Data
                                                    </button>
                                                    <button class="btn btn-danger" onclick="resetSystem()">
                                                        <i class="fas fa-trash me-2"></i> Reset System
                                                    </button>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Payment Modal -->
    <div class="modal-overlay" id="paymentModal">
        <div class="modal-content">
            <div class="modal-header bg-primary text-white">
                <h5 class="modal-title">Process Payment</h5>
                <button type="button" class="btn-close btn-close-white" onclick="closePaymentModal()"></button>
            </div>
            <div class="modal-body">
                <div id="paymentDetails">
                    <!-- Payment details will be loaded here -->
                </div>
            </div>
        </div>
    </div>
    
    <!-- Add Item Modal -->
    <div class="modal-overlay" id="addItemModal">
        <div class="modal-content" style="max-width: 600px;">
            <div class="modal-header bg-success text-white">
                <h5 class="modal-title">Add Menu Item</h5>
                <button type="button" class="btn-close btn-close-white" onclick="closeAddItemModal()"></button>
            </div>
            <div class="modal-body">
                <form id="addItemForm">
                    <div class="row">
                        <div class="col-md-6">
                            <div class="mb-3">
                                <label class="form-label">Item Name *</label>
                                <input type="text" class="form-control" id="itemName" required>
                            </div>
                            <div class="mb-3">
                                <label class="form-label">Category *</label>
                                <select class="form-select" id="itemCategory" required>
                                    <option value="Appetizers">Appetizers</option>
                                    <option value="Main Course">Main Course</option>
                                    <option value="Pizza">Pizza</option>
                                    <option value="Burgers">Burgers</option>
                                    <option value="Salads">Salads</option>
                                    <option value="Desserts">Desserts</option>
                                    <option value="Drinks">Drinks</option>
                                    <option value="Specials">Specials</option>
                                </select>
                            </div>
                            <div class="mb-3">
                                <label class="form-label">Price ($) *</label>
                                <input type="number" class="form-control" id="itemPrice" step="0.01" min="0" required>
                            </div>
                        </div>
                        <div class="col-md-6">
                            <div class="mb-3">
                                <label class="form-label">Cost ($)</label>
                                <input type="number" class="form-control" id="itemCost" step="0.01" min="0">
                            </div>
                            <div class="mb-3">
                                <label class="form-label">Preparation Time (mins)</label>
                                <input type="number" class="form-control" id="prepTime" min="1" max="120" value="15">
                            </div>
                            <div class="mb-3">
                                <div class="form-check form-switch">
                                    <input class="form-check-input" type="checkbox" id="itemAvailable" checked>
                                    <label class="form-check-label" for="itemAvailable">Available for ordering</label>
                                </div>
                            </div>
                        </div>
                    </div>
                    <div class="mb-3">
                        <label class="form-label">Description</label>
                        <textarea class="form-control" id="itemDescription" rows="3" placeholder="Describe the item..."></textarea>
                    </div>
                    <button type="submit" class="btn btn-success w-100">
                        <i class="fas fa-save me-2"></i> Save Item
                    </button>
                </form>
            </div>
        </div>
    </div>
    
    <!-- Order Details Modal -->
    <div class="modal-overlay" id="orderDetailsModal">
        <div class="modal-content" style="max-width: 800px;">
            <div class="modal-header bg-info text-white">
                <h5 class="modal-title">Order Details</h5>
                <button type="button" class="btn-close btn-close-white" onclick="closeOrderDetailsModal()"></button>
            </div>
            <div class="modal-body" id="orderDetailsContent">
                <!-- Order details will be loaded here -->
            </div>
        </div>
    </div>

    <!-- Bootstrap JS -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
    <!-- SweetAlert2 for notifications -->
    <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>
    <!-- DataTables -->
    <script src="https://cdn.datatables.net/1.13.6/js/jquery.dataTables.min.js"></script>
    <script src="https://cdn.datatables.net/1.13.6/js/dataTables.bootstrap5.min.js"></script>
    <!-- jQuery -->
    <script src="https://code.jquery.com/jquery-3.7.0.min.js"></script>
    
    <script>
        // ========== RESTAURANT DATA STRUCTURE ==========
        let restaurant = {
            menu: [],
            tables: [],
            orders: [],
            inventory: [],
            staff: [],
            customers: [],
            settings: {
                restaurantName: "RestaurantOS",
                currency: "$",
                taxRate: 0.10,
                serviceCharge: 0.05,
                enableTip: true,
                defaultTip: 0.15,
                autoPrint: true,
                autoBackup: true,
                language: "en",
                timezone: "UTC",
                dateFormat: "MM/DD/YYYY"
            },
            system: {
                version: "1.0.0",
                lastBackup: null,
                totalSales: 0,
                totalCustomers: 0
            }
        };

        let currentOrder = {
            items: [],
            tableId: null,
            customerName: '',
            customerPhone: '',
            status: 'pending',
            notes: '',
            createdAt: null
        };

        let currentSection = 'dashboard';
        let performanceChart = null;
        let salesChart = null;
        let revenueChart = null;
        let tableStatusChart = null;

        // ========== INITIALIZATION ==========
        document.addEventListener('DOMContentLoaded', function() {
            loadData();
            initializeClock();
            setupEventListeners();
            initializeCharts();
            updateDashboard();
            showToast('System initialized successfully!', 'success');
        });

        function loadData() {
            const savedData = localStorage.getItem('restaurantOSData');
            if (savedData) {
                const data = JSON.parse(savedData);
                restaurant = { ...restaurant, ...data };
                showToast('Data loaded successfully!', 'success');
            } else {
                initializeDemoData();
                showToast('New system initialized with demo data!', 'info');
            }
            
            // Initialize empty arrays if they don't exist
            if (!restaurant.inventory) restaurant.inventory = [];
            if (!restaurant.staff) restaurant.staff = [];
            if (!restaurant.customers) restaurant.customers = [];
            if (!restaurant.system) restaurant.system = {
                version: "1.0.0",
                lastBackup: null,
                totalSales: 0,
                totalCustomers: 0
            };
            
            saveData();
        }

        function initializeDemoData() {
            // Demo Menu Items
            restaurant.menu = [
                { 
                    id: 1, 
                    name: 'Margherita Pizza', 
                    category: 'Pizza', 
                    price: 12.99, 
                    cost: 4.50,
                    description: 'Classic cheese pizza with fresh basil',
                    prepTime: 15,
                    available: true,
                    image: null
                },
                { 
                    id: 2, 
                    name: 'Pepperoni Pizza', 
                    category: 'Pizza', 
                    price: 14.99, 
                    cost: 5.00,
                    description: 'Pepperoni pizza with extra cheese',
                    prepTime: 15,
                    available: true,
                    image: null
                },
                { 
                    id: 3, 
                    name: 'Caesar Salad', 
                    category: 'Salads', 
                    price: 8.99, 
                    cost: 2.50,
                    description: 'Fresh Caesar salad with croutons',
                    prepTime: 10,
                    available: true,
                    image: null
                },
                { 
                    id: 4, 
                    name: 'Chicken Burger', 
                    category: 'Burgers', 
                    price: 11.99, 
                    cost: 3.50,
                    description: 'Grilled chicken burger with fries',
                    prepTime: 12,
                    available: true,
                    image: null
                },
                { 
                    id: 5, 
                    name: 'Beef Steak', 
                    category: 'Main Course', 
                    price: 22.99, 
                    cost: 8.00,
                    description: 'Premium beef steak with mashed potatoes',
                    prepTime: 20,
                    available: true,
                    image: null
                },
                { 
                    id: 6, 
                    name: 'Pasta Carbonara', 
                    category: 'Main Course', 
                    price: 13.99, 
                    cost: 4.00,
                    description: 'Creamy pasta carbonara',
                    prepTime: 15,
                    available: true,
                    image: null
                },
                { 
                    id: 7, 
                    name: 'Coca Cola', 
                    category: 'Drinks', 
                    price: 2.99, 
                    cost: 0.50,
                    description: 'Soft drink',
                    prepTime: 2,
                    available: true,
                    image: null
                },
                { 
                    id: 8, 
                    name: 'Chocolate Cake', 
                    category: 'Desserts', 
                    price: 6.99, 
                    cost: 2.00,
                    description: 'Rich chocolate cake',
                    prepTime: 5,
                    available: true,
                    image: null
                }
            ];
            
            // Demo Tables
            restaurant.tables = [];
            for (let i = 1; i <= 20; i++) {
                restaurant.tables.push({
                    id: i,
                    number: i,
                    capacity: i <= 5 ? 2 : i <= 10 ? 4 : i <= 15 ? 6 : 8,
                    status: 'available',
                    customerName: '',
                    orderId: null,
                    location: i <= 10 ? 'Indoor' : 'Outdoor',
                    lastUsed: null
                });
            }
            
            // Demo Inventory
            restaurant.inventory = [
                { id: 1, name: 'Flour', category: 'Dry Goods', currentStock: 50, minStock: 20, unit: 'kg', costPerUnit: 2.50, lastRestocked: new Date().toISOString() },
                { id: 2, name: 'Tomato Sauce', category: 'Sauces', currentStock: 30, minStock: 10, unit: 'cans', costPerUnit: 1.20, lastRestocked: new Date().toISOString() },
                { id: 3, name: 'Cheese', category: 'Dairy', currentStock: 25, minStock: 15, unit: 'kg', costPerUnit: 8.50, lastRestocked: new Date().toISOString() },
                { id: 4, name: 'Chicken Breast', category: 'Meat', currentStock: 15, minStock: 10, unit: 'kg', costPerUnit: 12.00, lastRestocked: new Date().toISOString() }
            ];
            
            // Demo Staff
            restaurant.staff = [
                { id: 1, name: 'John Smith', role: 'Manager', phone: '+1234567890', email: 'john@restaurant.com', shift: 'Morning', status: 'active', rating: 4.5 },
                { id: 2, name: 'Sarah Johnson', role: 'Chef', phone: '+1234567891', email: 'sarah@restaurant.com', shift: 'Evening', status: 'active', rating: 4.8 },
                { id: 3, name: 'Mike Wilson', role: 'Waiter', phone: '+1234567892', email: 'mike@restaurant.com', shift: 'Morning', status: 'active', rating: 4.2 }
            ];
            
            // Demo Customers
            restaurant.customers = [
                { id: 1, name: 'Alice Brown', phone: '+1987654321', email: 'alice@email.com', totalVisits: 12, totalSpent: 450.50, lastVisit: new Date().toISOString(), loyaltyPoints: 1200 },
                { id: 2, name: 'Bob Wilson', phone: '+1987654322', email: 'bob@email.com', totalVisits: 8, totalSpent: 320.75, lastVisit: new Date().toISOString(), loyaltyPoints: 800 }
            ];
            
            // Demo Orders
            const today = new Date();
            const yesterday = new Date(today);
            yesterday.setDate(yesterday.getDate() - 1);
            
            restaurant.orders = [
                {
                    id: 1,
                    orderNumber: 'ORD-001',
                    tableId: 3,
                    customerName: 'Alice Brown',
                    customerPhone: '+1987654321',
                    items: [
                        { id: 1, name: 'Margherita Pizza', price: 12.99, quantity: 1 },
                        { id: 7, name: 'Coca Cola', price: 2.99, quantity: 2 }
                    ],
                    subtotal: 18.97,
                    tax: 1.90,
                    serviceCharge: 0.95,
                    total: 21.82,
                    status: 'completed',
                    paymentStatus: 'paid',
                    paymentMethod: 'card',
                    createdAt: yesterday.toISOString(),
                    completedAt: yesterday.toISOString()
                },
                {
                    id: 2,
                    orderNumber: 'ORD-002',
                    tableId: 5,
                    customerName: 'Bob Wilson',
                    customerPhone: '+1987654322',
                    items: [
                        { id: 4, name: 'Chicken Burger', price: 11.99, quantity: 2 },
                        { id: 8, name: 'Chocolate Cake', price: 6.99, quantity: 1 }
                    ],
                    subtotal: 30.97,
                    tax: 3.10,
                    serviceCharge: 1.55,
                    total: 35.62,
                    status: 'preparing',
                    paymentStatus: 'unpaid',
                    createdAt: today.toISOString()
                }
            ];
        }

        function setupEventListeners() {
            // Navigation links
            document.querySelectorAll('.nav-link').forEach(link => {
                link.addEventListener('click', function(e) {
                    e.preventDefault();
                    const section = this.getAttribute('data-section');
                    showSection(section);
                });
            });
            
            // Add item form
            document.getElementById('addItemForm').addEventListener('submit', function(e) {
                e.preventDefault();
                addMenuItem();
            });
            
            // Menu search
            document.getElementById('menuSearch')?.addEventListener('input', function() {
                filterMenuItems(this.value);
            });
            
            // Order search
            document.getElementById('orderSearch')?.addEventListener('input', function() {
                filterOrdersTable(this.value);
            });
            
            // Settings form elements
            document.getElementById('enableTip')?.addEventListener('change', function() {
                document.getElementById('defaultTip').disabled = !this.checked;
            });
            
            // Auto backup settings
            if (restaurant.settings.autoBackup) {
                setInterval(saveData, 300000); // Auto-save every 5 minutes
            }
        }

        // ========== SECTION MANAGEMENT ==========
        function showSection(sectionName) {
            if (currentSection === sectionName) return;
            
            // Hide all sections
            document.querySelectorAll('.section-content').forEach(section => {
                section.classList.remove('active');
            });
            
            // Remove active class from all nav links
            document.querySelectorAll('.nav-link').forEach(link => {
                link.classList.remove('active');
            });
            
            // Show selected section
            const sectionElement = document.getElementById(sectionName + 'Section');
            if (sectionElement) {
                sectionElement.classList.add('active');
                currentSection = sectionName;
                
                // Update nav link
                const navLink = document.querySelector(`.nav-link[data-section="${sectionName}"]`);
                if (navLink) navLink.classList.add('active');
                
                // Update title
                const titles = {
                    'dashboard': 'Dashboard',
                    'pos': 'Point of Sale',
                    'tables': 'Table Management',
                    'orders': 'Order Management',
                    'menu': 'Menu Management',
                    'inventory': 'Inventory Management',
                    'staff': 'Staff Management',
                    'customers': 'Customer Management',
                    'reports': 'Reports & Analytics',
                    'settings': 'System Settings'
                };
                document.getElementById('sectionTitle').textContent = titles[sectionName] || sectionName;
                
                // Load section data
                loadSectionData(sectionName);
            }
        }

        function loadSectionData(sectionName) {
            switch(sectionName) {
                case 'dashboard':
                    updateDashboard();
                    break;
                case 'pos':
                    loadPOS();
                    break;
                case 'tables':
                    loadTables();
                    break;
                case 'orders':
                    loadOrders();
                    break;
                case 'menu':
                    loadMenuManagement();
                    break;
                case 'inventory':
                    loadInventory();
                    break;
                case 'staff':
                    loadStaff();
                    break;
                case 'customers':
                    loadCustomers();
                    break;
                case 'reports':
                    loadReports();
                    break;
                case 'settings':
                    loadSettings();
                    break;
            }
        }

        function quickAction(action) {
            switch(action) {
                case 'newOrder':
                    showSection('pos');
                    break;
                case 'quickPayment':
                    showQuickPaymentModal();
                    break;
                case 'printReport':
                    generateDailyReport();
                    break;
            }
        }

        // ========== DASHBOARD FUNCTIONS ==========
        function updateDashboard() {
            updateDashboardStats();
            updateRecentOrders();
            updateCharts();
        }

        function updateDashboardStats() {
            const todayOrders = getTodayOrders();
            const todayRevenue = todayOrders.reduce((sum, order) => sum + order.total, 0);
            const occupiedTables = restaurant.tables.filter(t => t.status === 'occupied').length;
            const uniqueCustomers = new Set(todayOrders.map(o => o.customerPhone)).size;
            const avgOrderValue = todayOrders.length > 0 ? todayRevenue / todayOrders.length : 0;
            const occupancyRate = (occupiedTables / restaurant.tables.length) * 100;
            
            // Find top selling item
            let itemSales = {};
            todayOrders.forEach(order => {
                order.items.forEach(item => {
                    itemSales[item.name] = (itemSales[item.name] || 0) + item.quantity;
                });
            });
            
            let topSellingItem = '-';
            let maxSales = 0;
            for (const [item, sales] of Object.entries(itemSales)) {
                if (sales > maxSales) {
                    maxSales = sales;
                    topSellingItem = item;
                }
            }
            
            // Update DOM elements
            document.getElementById('todayRevenue').textContent = `${restaurant.settings.currency}${todayRevenue.toFixed(2)}`;
            document.getElementById('todayOrders').textContent = todayOrders.length;
            document.getElementById('activeTables').textContent = `${occupiedTables}/${restaurant.tables.length}`;
            document.getElementById('todayCustomers').textContent = uniqueCustomers;
            document.getElementById('avgOrderValue').textContent = `${restaurant.settings.currency}${avgOrderValue.toFixed(2)}`;
            document.getElementById('occupancyRate').textContent = `${occupancyRate.toFixed(1)}%`;
            document.getElementById('topSellingItem').textContent = topSellingItem;
        }

        function updateRecentOrders() {
            const container = document.getElementById('recentOrders');
            const todayOrders = getTodayOrders().slice(0, 10); // Show last 10 orders
            
            if (todayOrders.length === 0) {
                container.innerHTML = `
                    <tr>
                        <td colspan="6" class="text-center py-4">
                            <i class="fas fa-shopping-cart fa-2x text-muted mb-3"></i>
                            <p class="text-muted">No orders today</p>
                        </td>
                    </tr>
                `;
                return;
            }
            
            let html = '';
            todayOrders.forEach(order => {
                const time = new Date(order.createdAt).toLocaleTimeString([], {hour: '2-digit', minute:'2-digit'});
                const statusBadge = getStatusBadge(order.status);
                
                html += `
                    <tr>
                        <td><strong>${order.orderNumber}</strong></td>
                        <td>${order.tableId ? `Table ${order.tableId}` : 'Takeaway'}</td>
                        <td>${order.customerName || 'Walk-in'}</td>
                        <td>${restaurant.settings.currency}${order.total.toFixed(2)}</td>
                        <td><span class="status-badge ${statusBadge}">${order.status}</span></td>
                        <td>${time}</td>
                    </tr>
                `;
            });
            
            container.innerHTML = html;
        }

        function initializeCharts() {
            const ctx1 = document.getElementById('performanceChart')?.getContext('2d');
            if (ctx1) {
                performanceChart = new Chart(ctx1, {
                    type: 'line',
                    data: {
                        labels: ['6am', '9am', '12pm', '3pm', '6pm', '9pm'],
                        datasets: [{
                            label: 'Orders',
                            data: [12, 19, 8, 15, 22, 18],
                            borderColor: '#4361ee',
                            backgroundColor: 'rgba(67, 97, 238, 0.1)',
                            tension: 0.4
                        }]
                    },
                    options: {
                        responsive: true,
                        plugins: {
                            legend: {
                                display: false
                            }
                        }
                    }
                });
            }
        }

        function updateCharts() {
            // Update performance chart with real data
            if (performanceChart) {
                const hourlyData = getHourlyOrderData();
                performanceChart.data.datasets[0].data = hourlyData;
                performanceChart.update();
            }
        }

        function getHourlyOrderData() {
            // This would normally calculate orders per hour
            // For now, return sample data
            return [5, 12, 25, 18, 30, 22, 15];
        }

        // ========== POS FUNCTIONS ==========
        function loadPOS() {
            loadMenuCategories();
            loadMenuItems();
            loadTableOptions();
            updateOrderSummary();
            
            // Add search functionality
            document.getElementById('menuSearch').addEventListener('input', function(e) {
                filterMenuItems(e.target.value);
            });
        }

        function loadMenuCategories() {
            const container = document.getElementById('categoryTabs');
            if (!container) return;
            
            const categories = ['All', ...new Set(restaurant.menu.map(item => item.category))];
            
            let html = '';
            categories.forEach(category => {
                html += `
                    <button class="category-tab ${category === 'All' ? 'active' : ''}" 
                            onclick="filterMenuByCategory('${category}')">
                        ${category}
                    </button>
                `;
            });
            
            container.innerHTML = html;
        }

        function filterMenuByCategory(category) {
            document.querySelectorAll('.category-tab').forEach(tab => {
                tab.classList.remove('active');
            });
            event.target.classList.add('active');
            
            loadMenuItems(category === 'All' ? null : category);
        }

        function loadMenuItems(category = null, searchTerm = '') {
            const container = document.getElementById('menuItemsContainer');
            if (!container) return;
            
            let filteredItems = restaurant.menu.filter(item => item.available);
            
            if (category && category !== 'All') {
                filteredItems = filteredItems.filter(item => item.category === category);
            }
            
            if (searchTerm) {
                const term = searchTerm.toLowerCase();
                filteredItems = filteredItems.filter(item => 
                    item.name.toLowerCase().includes(term) || 
                    item.description.toLowerCase().includes(term)
                );
            }
            
            if (filteredItems.length === 0) {
                container.innerHTML = `
                    <div class="col-12 text-center py-5">
                        <i class="fas fa-utensils fa-3x text-muted mb-3"></i>
                        <p class="text-muted">No items found</p>
                        <button class="btn btn-primary mt-2" onclick="showAddItemModal()">
                            <i class="fas fa-plus me-2"></i> Add New Item
                        </button>
                    </div>
                `;
                return;
            }
            
            let html = '';
            filteredItems.forEach(item => {
                const profit = item.price - (item.cost || 0);
                const profitMargin = item.cost ? ((profit / item.price) * 100).toFixed(1) : 'N/A';
                
                html += `
                    <div class="col-md-4 mb-3">
                        <div class="menu-item-card" onclick="addToOrder(${item.id})">
                            <div class="d-flex justify-content-between align-items-start mb-2">
                                <div>
                                    <h6 class="mb-1">${item.name}</h6>
                                    <small class="text-muted">${item.category}</small>
                                </div>
                                <div class="text-end">
                                    <strong>${restaurant.settings.currency}${item.price.toFixed(2)}</strong>
                                    ${item.cost ? `
                                        <br><small class="text-success">${profitMargin}% margin</small>
                                    ` : ''}
                                </div>
                            </div>
                            <p class="small text-muted mb-2">${item.description || 'No description'}</p>
                            <div class="d-flex justify-content-between align-items-center">
                                <small class="text-info">
                                    <i class="fas fa-clock me-1"></i>${item.prepTime} mins
                                </small>
                                <small class="text-success">
                                    <i class="fas fa-plus-circle"></i> Add to order
                                </small>
                            </div>
                        </div>
                    </div>
                `;
            });
            
            container.innerHTML = html;
        }

        function filterMenuItems(searchTerm) {
            const activeTab = document.querySelector('.category-tab.active');
            const category = activeTab ? activeTab.textContent : 'All';
            loadMenuItems(category === 'All' ? null : category, searchTerm);
        }

        function loadTableOptions() {
            const select = document.getElementById('tableSelect');
            if (!select) return;
            
            let html = '<option value="">Select Table</option>';
            
            restaurant.tables.forEach(table => {
                const disabled = table.status === 'occupied' || table.status === 'maintenance' ? 'disabled' : '';
                const statusText = table.status.charAt(0).toUpperCase() + table.status.slice(1);
                
                html += `
                    <option value="${table.id}" ${disabled}>
                        Table ${table.number} (${table.capacity} seats) - ${statusText}
                    </option>
                `;
            });
            
            select.innerHTML = html;
        }

        function addToOrder(itemId) {
            const item = restaurant.menu.find(m => m.id === itemId);
            if (!item) return;
            
            // Visual feedback
            const menuCard = event.target.closest('.menu-item-card');
            if (menuCard) {
                menuCard.classList.add('selected');
                setTimeout(() => menuCard.classList.remove('selected'), 500);
            }
            
            const existingItem = currentOrder.items.find(i => i.id === itemId);
            if (existingItem) {
                existingItem.quantity++;
            } else {
                currentOrder.items.push({
                    id: item.id,
                    name: item.name,
                    price: item.price,
                    quantity: 1
                });
            }
            
            updateOrderSummary();
            showToast(`${item.name} added to order`, 'success');
        }

        function updateOrderSummary() {
            const container = document.getElementById('orderItems');
            const subtotalEl = document.getElementById('subtotal');
            const taxEl = document.getElementById('taxAmount');
            const serviceEl = document.getElementById('serviceCharge');
            const totalEl = document.getElementById('totalAmount');
            const orderCounter = document.getElementById('orderCounter');
            
            if (currentOrder.items.length === 0) {
                container.innerHTML = `
                    <div class="text-center text-muted py-5">
                        <i class="fas fa-shopping-cart fa-2x mb-3"></i>
                        <p>No items added yet</p>
                        <small>Click on menu items to add them to your order</small>
                    </div>
                `;
                updateTotals(0);
                orderCounter.textContent = '0 items';
                return;
            }
            
            let html = '';
            currentOrder.items.forEach((item, index) => {
                const itemTotal = item.price * item.quantity;
                html += `
                    <div class="order-item">
                        <div>
                            <strong>${item.name}</strong><br>
                            <small>${restaurant.settings.currency}${item.price.toFixed(2)} each</small>
                        </div>
                        <div class="quantity-controls">
                            <button class="btn btn-sm btn-outline-secondary" onclick="updateItemQuantity(${index}, -1)">
                                <i class="fas fa-minus"></i>
                            </button>
                            <span class="mx-2 fw-bold">${item.quantity}</span>
                            <button class="btn btn-sm btn-outline-secondary" onclick="updateItemQuantity(${index}, 1)">
                                <i class="fas fa-plus"></i>
                            </button>
                            <button class="btn btn-sm btn-danger ms-2" onclick="removeItem(${index})">
                                <i class="fas fa-trash"></i>
                            </button>
                        </div>
                    </div>
                `;
            });
            
            container.innerHTML = html;
            
            const subtotal = currentOrder.items.reduce((sum, item) => sum + (item.price * item.quantity), 0);
            updateTotals(subtotal);
            
            orderCounter.textContent = `${currentOrder.items.reduce((sum, item) => sum + item.quantity, 0)} items`;
        }

        function updateItemQuantity(index, change) {
            if (!currentOrder.items[index]) return;
            
            currentOrder.items[index].quantity += change;
            
            if (currentOrder.items[index].quantity <= 0) {
                currentOrder.items.splice(index, 1);
            }
            
            updateOrderSummary();
        }

        function removeItem(index) {
            const itemName = currentOrder.items[index].name;
            currentOrder.items.splice(index, 1);
            updateOrderSummary();
            showToast(`${itemName} removed from order`, 'warning');
        }

        function updateTotals(subtotal) {
            const tax = subtotal * restaurant.settings.taxRate;
            const service = subtotal * restaurant.settings.serviceCharge;
            const total = subtotal + tax + service;
            
            document.getElementById('subtotal').textContent = `${restaurant.settings.currency}${subtotal.toFixed(2)}`;
            document.getElementById('taxAmount').textContent = `${restaurant.settings.currency}${tax.toFixed(2)}`;
            document.getElementById('serviceCharge').textContent = `${restaurant.settings.currency}${service.toFixed(2)}`;
            document.getElementById('totalAmount').textContent = `${restaurant.settings.currency}${total.toFixed(2)}`;
            
            // Update rates display
            document.getElementById('taxRate').textContent = (restaurant.settings.taxRate * 100);
            document.getElementById('serviceRate').textContent = (restaurant.settings.serviceCharge * 100);
        }

        function clearOrder() {
            if (currentOrder.items.length === 0) {
                showToast('Order is already empty', 'info');
                return;
            }
            
            Swal.fire({
                title: 'Clear Order?',
                text: 'This will remove all items from the current order',
                icon: 'warning',
                showCancelButton: true,
                confirmButtonText: 'Yes, clear it!',
                cancelButtonText: 'Cancel',
                confirmButtonColor: '#d33'
            }).then((result) => {
                if (result.isConfirmed) {
                    currentOrder = {
                        items: [],
                        tableId: null,
                        customerName: '',
                        customerPhone: '',
                        status: 'pending',
                        notes: '',
                        createdAt: null
                    };
                    
                    document.getElementById('tableSelect').value = '';
                    document.getElementById('customerName').value = '';
                    document.getElementById('customerPhone').value = '';
                    updateOrderSummary();
                    
                    showToast('Order cleared', 'success');
                }
            });
        }

        function saveOrder() {
            if (currentOrder.items.length === 0) {
                showToast('Please add items to the order', 'error');
                return;
            }
            
            const tableSelect = document.getElementById('tableSelect');
            const customerName = document.getElementById('customerName').value || 'Walk-in Customer';
            const customerPhone = document.getElementById('customerPhone').value || '';
            
            // Calculate totals
            const subtotal = currentOrder.items.reduce((sum, item) => sum + (item.price * item.quantity), 0);
            const tax = subtotal * restaurant.settings.taxRate;
            const service = subtotal * restaurant.settings.serviceCharge;
            const total = subtotal + tax + service;
            
            // Generate order number
            const orderId = restaurant.orders.length + 1;
            const orderNumber = `ORD-${String(orderId).padStart(4, '0')}`;
            
            const newOrder = {
                id: orderId,
                orderNumber: orderNumber,
                tableId: tableSelect.value ? parseInt(tableSelect.value) : null,
                customerName: customerName,
                customerPhone: customerPhone,
                items: JSON.parse(JSON.stringify(currentOrder.items)),
                subtotal: subtotal,
                tax: tax,
                serviceCharge: service,
                total: total,
                status: 'pending',
                paymentStatus: 'unpaid',
                createdAt: new Date().toISOString(),
                notes: currentOrder.notes
            };
            
            restaurant.orders.push(newOrder);
            
            // Update table status if table is selected
            if (tableSelect.value) {
                const tableId = parseInt(tableSelect.value);
                const table = restaurant.tables.find(t => t.id === tableId);
                if (table) {
                    table.status = 'occupied';
                    table.customerName = customerName;
                    table.orderId = orderId;
                    table.lastUsed = new Date().toISOString();
                }
            }
            
            // Update customer record
            if (customerPhone) {
                let customer = restaurant.customers.find(c => c.phone === customerPhone);
                if (!customer) {
                    customer = {
                        id: restaurant.customers.length + 1,
                        name: customerName,
                        phone: customerPhone,
                        email: '',
                        totalVisits: 1,
                        totalSpent: total,
                        lastVisit: new Date().toISOString(),
                        loyaltyPoints: Math.floor(total)
                    };
                    restaurant.customers.push(customer);
                } else {
                    customer.totalVisits += 1;
                    customer.totalSpent += total;
                    customer.lastVisit = new Date().toISOString();
                    customer.loyaltyPoints += Math.floor(total);
                }
            }
            
            // Clear current order
            currentOrder = {
                items: [],
                tableId: null,
                customerName: '',
                customerPhone: '',
                status: 'pending',
                notes: '',
                createdAt: null
            };
            
            document.getElementById('tableSelect').value = '';
            document.getElementById('customerName').value = '';
            document.getElementById('customerPhone').value = '';
            updateOrderSummary();
            
            saveData();
            updateDashboard();
            
            // Show success message
            Swal.fire({
                title: 'Order Saved!',
                html: `
                    <div class="text-center">
                        <i class="fas fa-check-circle fa-3x text-success mb-3"></i>
                        <h5>Order #${orderNumber}</h5>
                        <p>Total: <strong>${restaurant.settings.currency}${total.toFixed(2)}</strong></p>
                        <p class="text-muted">Status: <span class="text-warning">Pending</span></p>
                    </div>
                `,
                confirmButtonText: 'OK',
                confirmButtonColor: '#28a745'
            });
            
            // Print kitchen ticket
            if (restaurant.settings.autoPrint) {
                printKitchenTicket(newOrder);
            }
        }

        function processPayment() {
            if (currentOrder.items.length === 0) {
                showSelectOrderForPayment();
                return;
            }
            
            const subtotal = currentOrder.items.reduce((sum, item) => sum + (item.price * item.quantity), 0);
            const tax = subtotal * restaurant.settings.taxRate;
            const service = subtotal * restaurant.settings.serviceCharge;
            const total = subtotal + tax + service;
            
            showPaymentModal(total);
        }

        function showSelectOrderForPayment() {
            const unpaidOrders = restaurant.orders.filter(order => order.paymentStatus === 'unpaid');
            
            if (unpaidOrders.length === 0) {
                showToast('No unpaid orders found', 'info');
                return;
            }
            
            let optionsHtml = '';
            unpaidOrders.forEach(order => {
                optionsHtml += `
                    <option value="${order.id}">
                        ${order.orderNumber} - ${order.tableId ? `Table ${order.tableId}` : 'Takeaway'} - ${restaurant.settings.currency}${order.total.toFixed(2)}
                    </option>
                `;
            });
            
            Swal.fire({
                title: 'Select Order to Pay',
                html: `
                    <div class="text-start">
                        <div class="mb-3">
                            <label class="form-label">Select Order</label>
                            <select class="form-select" id="selectOrderToPay">
                                ${optionsHtml}
                            </select>
                        </div>
                    </div>
                `,
                showCancelButton: true,
                confirmButtonText: 'Process Payment',
                cancelButtonText: 'Cancel',
                preConfirm: () => {
                    const orderId = parseInt(document.getElementById('selectOrderToPay').value);
                    const order = restaurant.orders.find(o => o.id === orderId);
                    return order;
                }
            }).then((result) => {
                if (result.isConfirmed) {
                    showPaymentModal(result.value.total, result.value.id);
                }
            });
        }

        function showPaymentModal(totalAmount, orderId = null) {
            const modal = document.getElementById('paymentModal');
            const container = document.getElementById('paymentDetails');
            
            // Store data for later use
            modal.dataset.totalAmount = totalAmount;
            modal.dataset.orderId = orderId || '';
            
            let tipSection = '';
            if (restaurant.settings.enableTip) {
                tipSection = `
                    <div class="mb-3">
                        <label class="form-label">Tip</label>
                        <div class="btn-group w-100" role="group">
                            <button type="button" class="btn btn-outline-secondary" onclick="setTip(10)">10%</button>
                            <button type="button" class="btn btn-outline-secondary" onclick="setTip(15)">15%</button>
                            <button type="button" class="btn btn-outline-secondary" onclick="setTip(20)">20%</button>
                            <button type="button" class="btn btn-outline-secondary" onclick="setTip(0)">No Tip</button>
                        </div>
                        <div class="input-group mt-2">
                            <span class="input-group-text">${restaurant.settings.currency}</span>
                            <input type="number" class="form-control" id="tipAmount" value="${(totalAmount * restaurant.settings.defaultTip).toFixed(2)}" step="0.01" min="0">
                        </div>
                    </div>
                `;
            }
            
            container.innerHTML = `
                <div class="mb-4 text-center">
                    <h4>Payment Due</h4>
                    <h1 class="text-primary">${restaurant.settings.currency}${totalAmount.toFixed(2)}</h1>
                </div>
                
                <div class="mb-3">
                    <label class="form-label">Payment Method</label>
                    <select class="form-select" id="paymentMethod">
                        <option value="cash">Cash</option>
                        <option value="card">Credit/Debit Card</option>
                        <option value="upi">UPI/QR Code</option>
                        <option value="wallet">Digital Wallet</option>
                        <option value="loyalty">Loyalty Points</option>
                    </select>
                </div>
                
                ${tipSection}
                
                <div class="mb-3">
                    <label class="form-label">Amount Paid</label>
                    <div class="input-group">
                        <span class="input-group-text">${restaurant.settings.currency}</span>
                        <input type="number" class="form-control" id="amountPaid" 
                               value="${totalAmount.toFixed(2)}" step="0.01" min="${totalAmount.toFixed(2)}">
                    </div>
                </div>
                
                <div class="mb-3" id="changeAmount" style="display: none;">
                    <div class="alert alert-success">
                        <strong>Change Due:</strong> 
                        <span id="changeValue">${restaurant.settings.currency}0.00</span>
                    </div>
                </div>
                
                <div class="d-grid gap-2">
                    <button class="btn btn-success btn-lg" onclick="completePaymentModal()">
                        <i class="fas fa-check-circle me-2"></i> Complete Payment
                    </button>
                    <button class="btn btn-secondary" onclick="closePaymentModal()">
                        Cancel
                    </button>
                </div>
            `;
            
            modal.classList.add('active');
            
            // Add event listeners
            document.getElementById('amountPaid').addEventListener('input', calculateChange);
            document.getElementById('tipAmount')?.addEventListener('input', updateTotalWithTip);
        }

        function setTip(percentage) {
            const totalAmount = parseFloat(document.getElementById('paymentModal').dataset.totalAmount);
            const tipAmount = totalAmount * (percentage / 100);
            document.getElementById('tipAmount').value = tipAmount.toFixed(2);
            updateTotalWithTip();
        }

        function updateTotalWithTip() {
            const tipInput = document.getElementById('tipAmount');
            if (tipInput) {
                const totalAmount = parseFloat(document.getElementById('paymentModal').dataset.totalAmount);
                const tipAmount = parseFloat(tipInput.value) || 0;
                const newTotal = totalAmount + tipAmount;
                
                // Update the displayed total
                const paymentDetails = document.getElementById('paymentDetails');
                const totalElement = paymentDetails.querySelector('h1');
                if (totalElement) {
                    totalElement.textContent = `${restaurant.settings.currency}${newTotal.toFixed(2)}`;
                }
                
                // Update amount paid field
                const amountPaid = document.getElementById('amountPaid');
                amountPaid.value = newTotal.toFixed(2);
                amountPaid.min = newTotal.toFixed(2);
                
                calculateChange();
            }
        }

        function calculateChange() {
            const amountPaidInput = document.getElementById('amountPaid');
            if (!amountPaidInput) return;
            
            const totalElement = document.getElementById('paymentDetails').querySelector('h1');
            const totalAmount = parseFloat(totalElement.textContent.replace(restaurant.settings.currency, ''));
            const amountPaid = parseFloat(amountPaidInput.value) || 0;
            const change = amountPaid - totalAmount;
            
            const changeDiv = document.getElementById('changeAmount');
            const changeValue = document.getElementById('changeValue');
            
            if (change > 0) {
                changeDiv.style.display = 'block';
                changeValue.textContent = `${restaurant.settings.currency}${change.toFixed(2)}`;
            } else {
                changeDiv.style.display = 'none';
            }
        }

        function completePaymentModal() {
            const modal = document.getElementById('paymentModal');
            const totalAmount = parseFloat(modal.dataset.totalAmount);
            const orderId = modal.dataset.orderId ? parseInt(modal.dataset.orderId) : null;
            
            completePayment(totalAmount, orderId);
        }

        function completePayment(totalAmount, orderId = null) {
            const paymentMethod = document.getElementById('paymentMethod').value;
            let amountPaid = parseFloat(document.getElementById('amountPaid').value);
            
            // Add tip if applicable
            const tipInput = document.getElementById('tipAmount');
            let tipAmount = 0;
            if (tipInput && restaurant.settings.enableTip) {
                tipAmount = parseFloat(tipInput.value) || 0;
            }
            
            const finalTotal = totalAmount + tipAmount;
            
            if (!amountPaid || amountPaid < finalTotal) {
                showToast('Amount paid must be equal to or greater than total', 'error');
                return;
            }
            
            const change = amountPaid - finalTotal;
            
            if (orderId) {
                // Update existing order
                const order = restaurant.orders.find(o => o.id === orderId);
                if (order) {
                    order.paymentStatus = 'paid';
                    order.paymentMethod = paymentMethod;
                    order.amountPaid = amountPaid;
                    order.change = change;
                    order.tip = tipAmount;
                    order.status = 'completed';
                    order.completedAt = new Date().toISOString();
                    
                    // Free up table if occupied
                    if (order.tableId) {
                        const table = restaurant.tables.find(t => t.id === order.tableId);
                        if (table) {
                            table.status = 'available';
                            table.customerName = '';
                            table.orderId = null;
                        }
                    }
                    
                    saveData();
                    updateDashboard();
                    closePaymentModal();
                    
                    // Print receipt
                    printReceipt(order, amountPaid, change, tipAmount);
                    
                    showToast(`Payment for ${order.orderNumber} completed!`, 'success');
                }
            } else {
                // Create new order and mark as paid
                const tableSelect = document.getElementById('tableSelect');
                const customerName = document.getElementById('customerName').value || 'Walk-in Customer';
                const customerPhone = document.getElementById('customerPhone').value || '';
                
                // Calculate totals
                const subtotal = currentOrder.items.reduce((sum, item) => sum + (item.price * item.quantity), 0);
                const tax = subtotal * restaurant.settings.taxRate;
                const service = subtotal * restaurant.settings.serviceCharge;
                const total = subtotal + tax + service;
                
                // Generate order number
                const newOrderId = restaurant.orders.length + 1;
                const orderNumber = `ORD-${String(newOrderId).padStart(4, '0')}`;
                
                const newOrder = {
                    id: newOrderId,
                    orderNumber: orderNumber,
                    tableId: tableSelect.value ? parseInt(tableSelect.value) : null,
                    customerName: customerName,
                    customerPhone: customerPhone,
                    items: JSON.parse(JSON.stringify(currentOrder.items)),
                    subtotal: subtotal,
                    tax: tax,
                    serviceCharge: service,
                    tip: tipAmount,
                    total: total + tipAmount,
                    status: 'completed',
                    paymentStatus: 'paid',
                    paymentMethod: paymentMethod,
                    amountPaid: amountPaid,
                    change: change,
                    createdAt: new Date().toISOString(),
                    completedAt: new Date().toISOString()
                };
                
                restaurant.orders.push(newOrder);
                
                // Update customer record
                if (customerPhone) {
                    let customer = restaurant.customers.find(c => c.phone === customerPhone);
                    if (!customer) {
                        customer = {
                            id: restaurant.customers.length + 1,
                            name: customerName,
                            phone: customerPhone,
                            email: '',
                            totalVisits: 1,
                            totalSpent: total + tipAmount,
                            lastVisit: new Date().toISOString(),
                            loyaltyPoints: Math.floor(total + tipAmount)
                        };
                        restaurant.customers.push(customer);
                    } else {
                        customer.totalVisits += 1;
                        customer.totalSpent += total + tipAmount;
                        customer.lastVisit = new Date().toISOString();
                        customer.loyaltyPoints += Math.floor(total + tipAmount);
                    }
                }
                
                // Clear current order
                currentOrder = {
                    items: [],
                    tableId: null,
                    customerName: '',
                    customerPhone: '',
                    status: 'pending',
                    notes: '',
                    createdAt: null
                };
                
                document.getElementById('tableSelect').value = '';
                document.getElementById('customerName').value = '';
                document.getElementById('customerPhone').value = '';
                updateOrderSummary();
                
                saveData();
                updateDashboard();
                closePaymentModal();
                
                // Print receipt
                printReceipt(newOrder, amountPaid, change, tipAmount);
                
                showToast(`Order #${orderNumber} created and paid!`, 'success');
            }
        }

        function closePaymentModal() {
            document.getElementById('paymentModal').classList.remove('active');
        }

        // ========== TABLE MANAGEMENT FUNCTIONS ==========
        function loadTables() {
            loadTablesGrid();
            loadActionTableOptions();
            updateTableStatistics();
        }

        function loadTablesGrid() {
            const container = document.getElementById('tablesGrid');
            if (!container) return;
            
            container.innerHTML = '';
            
            restaurant.tables.forEach(table => {
                const tableDiv = document.createElement('div');
                tableDiv.className = `table-card ${table.status}`;
                tableDiv.innerHTML = `
                    <div class="table-icon mb-2">
                        <i class="fas fa-${table.capacity <= 2 ? 'user' : 'users'} fa-2x"></i>
                    </div>
                    <div class="h5 mb-2">Table ${table.number}</div>
                    <div class="mb-2">
                        <span class="badge bg-secondary">${table.capacity} seats</span>
                        <span class="badge bg-light text-dark">${table.location}</span>
                    </div>
                    <div class="badge bg-${getTableStatusColor(table.status)} mb-2">
                        ${table.status.toUpperCase()}
                    </div>
                    ${table.customerName ? `<div class="mt-2"><small><i class="fas fa-user me-1"></i>${table.customerName}</small></div>` : ''}
                    ${table.lastUsed ? `<div><small class="text-muted">Last: ${formatTime(table.lastUsed)}</small></div>` : ''}
                `;
                
                tableDiv.onclick = () => selectTable(table.id);
                container.appendChild(tableDiv);
            });
        }

        function getTableStatusColor(status) {
            switch(status) {
                case 'available': return 'success';
                case 'occupied': return 'danger';
                case 'reserved': return 'warning';
                case 'maintenance': return 'secondary';
                default: return 'dark';
            }
        }

        function selectTable(tableId) {
            const table = restaurant.tables.find(t => t.id === tableId);
            if (table) {
                document.getElementById('actionTableSelect').value = tableId;
                document.getElementById('tableAction').value = table.status;
                document.getElementById('tableCustomer').value = table.customerName || '';
                
                showToast(`Table ${table.number} selected`, 'info');
            }
        }

        function loadActionTableOptions() {
            const select = document.getElementById('actionTableSelect');
            if (!select) return;
            
            let html = '<option value="">Choose table</option>';
            
            restaurant.tables.forEach(table => {
                html += `<option value="${table.id}">Table ${table.number} (${table.capacity} seats)</option>`;
            });
            
            select.innerHTML = html;
        }

        function updateTableStatus() {
            const tableId = document.getElementById('actionTableSelect').value;
            const action = document.getElementById('tableAction').value;
            const customerName = document.getElementById('tableCustomer').value;
            
            if (!tableId) {
                showToast('Please select a table', 'error');
                return;
            }
            
            const table = restaurant.tables.find(t => t.id === parseInt(tableId));
            if (!table) return;
            
            table.status = action;
            table.customerName = customerName || '';
            
            if (action === 'occupied') {
                table.lastUsed = new Date().toISOString();
            }
            
            saveData();
            loadTablesGrid();
            updateDashboard();
            
            showToast(`Table ${table.number} status updated to ${action}`, 'success');
        }

        function updateTableStatistics() {
            // Update table status chart
            const statusCounts = {
                available: restaurant.tables.filter(t => t.status === 'available').length,
                occupied: restaurant.tables.filter(t => t.status === 'occupied').length,
                reserved: restaurant.tables.filter(t => t.status === 'reserved').length,
                maintenance: restaurant.tables.filter(t => t.status === 'maintenance').length
            };
            
            const ctx = document.getElementById('tableStatusChart')?.getContext('2d');
            if (ctx) {
                if (tableStatusChart) tableStatusChart.destroy();
                
                tableStatusChart = new Chart(ctx, {
                    type: 'doughnut',
                    data: {
                        labels: ['Available', 'Occupied', 'Reserved', 'Maintenance'],
                        datasets: [{
                            data: [statusCounts.available, statusCounts.occupied, statusCounts.reserved, statusCounts.maintenance],
                            backgroundColor: ['#28a745', '#dc3545', '#ffc107', '#6c757d']
                        }]
                    },
                    options: {
                        responsive: true,
                        plugins: {
                            legend: {
                                position: 'bottom'
                            }
                        }
                    }
                });
            }
        }

        function addNewTable() {
            const newTableNumber = restaurant.tables.length + 1;
            const newTable = {
                id: newTableNumber,
                number: newTableNumber,
                capacity: 4,
                status: 'available',
                customerName: '',
                orderId: null,
                location: 'Indoor',
                lastUsed: null
            };
            
            restaurant.tables.push(newTable);
            saveData();
            loadTablesGrid();
            showToast(`New table ${newTableNumber} added`, 'success');
        }

        function updateAllTables() {
            restaurant.tables.forEach(table => {
                if (table.status === 'occupied') {
                    // Check if order is completed
                    const order = restaurant.orders.find(o => o.id === table.orderId);
                    if (order && order.status === 'completed') {
                        table.status = 'available';
                        table.customerName = '';
                        table.orderId = null;
                    }
                }
            });
            
            saveData();
            loadTablesGrid();
            showToast('All tables updated', 'info');
        }

        // ========== ORDER MANAGEMENT FUNCTIONS ==========
        function loadOrders() {
            updateOrdersTable();
            updateOrderCounts();
        }

        function updateOrdersTable() {
            const container = document.getElementById('ordersTableBody');
            if (!container) return;
            
            const todayOrders = getTodayOrders();
            
            if (todayOrders.length === 0) {
                container.innerHTML = `
                    <tr>
                        <td colspan="8" class="text-center py-4">
                            <i class="fas fa-clipboard-list fa-2x text-muted mb-3"></i>
                            <p class="text-muted">No orders today</p>
                        </td>
                    </tr>
                `;
                return;
            }
            
            let html = '';
            todayOrders.forEach(order => {
                const time = new Date(order.createdAt).toLocaleTimeString([], {hour: '2-digit', minute:'2-digit'});
                const statusBadge = getStatusBadge(order.status);
                const paymentBadge = order.paymentStatus === 'paid' ? 'bg-success' : 'bg-danger';
                
                html += `
                    <tr>
                        <td><strong>${order.orderNumber}</strong></td>
                        <td>${order.tableId ? `Table ${order.tableId}` : 'Takeaway'}</td>
                        <td>${order.customerName}</td>
                        <td>${order.items.length} items</td>
                        <td><strong>${restaurant.settings.currency}${order.total.toFixed(2)}</strong></td>
                        <td>
                            <span class="status-badge ${statusBadge}">${order.status}</span>
                            <span class="badge ${paymentBadge} ms-1">${order.paymentStatus}</span>
                        </td>
                        <td>${time}</td>
                        <td>
                            <div class="btn-group btn-group-sm">
                                <button class="btn btn-info" onclick="viewOrderDetails(${order.id})" title="View Details">
                                    <i class="fas fa-eye"></i>
                                </button>
                                <button class="btn btn-warning" onclick="editOrder(${order.id})" title="Edit Order">
                                    <i class="fas fa-edit"></i>
                                </button>
                                <button class="btn btn-success" onclick="updateOrderStatus(${order.id}, 'completed')" 
                                        ${order.status === 'completed' ? 'disabled' : ''} title="Mark as Completed">
                                    <i class="fas fa-check"></i>
                                </button>
                            </div>
                        </td>
                    </tr>
                `;
            });
            
            container.innerHTML = html;
        }

        function updateOrderCounts() {
            const todayOrders = getTodayOrders();
            const pending = todayOrders.filter(o => o.status === 'pending').length;
            const preparing = todayOrders.filter(o => o.status === 'preparing').length;
            const ready = todayOrders.filter(o => o.status === 'ready').length;
            const completed = todayOrders.filter(o => o.status === 'completed').length;
            
            document.getElementById('pendingCount').textContent = pending;
            document.getElementById('preparingCount').textContent = preparing;
            document.getElementById('readyCount').textContent = ready;
            document.getElementById('completedCount').textContent = completed;
        }

        function getStatusBadge(status) {
            switch(status) {
                case 'pending': return 'status-pending';
                case 'preparing': return 'status-preparing';
                case 'ready': return 'status-ready';
                case 'served': return 'status-served';
                case 'completed': return 'status-completed';
                case 'cancelled': return 'status-cancelled';
                default: return 'status-pending';
            }
        }

        function viewOrderDetails(orderId) {
            const order = restaurant.orders.find(o => o.id === orderId);
            if (!order) return;
            
            let itemsHtml = '';
            order.items.forEach(item => {
                itemsHtml += `
                    <div class="d-flex justify-content-between mb-2">
                        <div>
                            ${item.name} √ó ${item.quantity}
                            <br><small class="text-muted">${restaurant.settings.currency}${item.price.toFixed(2)} each</small>
                        </div>
                        <div>${restaurant.settings.currency}${(item.price * item.quantity).toFixed(2)}</div>
                    </div>
                `;
            });
            
            const modalContent = document.getElementById('orderDetailsContent');
            modalContent.innerHTML = `
                <div class="row">
                    <div class="col-md-6">
                        <h6>Order Information</h6>
                        <p><strong>Order #:</strong> ${order.orderNumber}</p>
                        <p><strong>Customer:</strong> ${order.customerName}</p>
                        <p><strong>Table:</strong> ${order.tableId ? `Table ${order.tableId}` : 'Takeaway'}</p>
                        <p><strong>Phone:</strong> ${order.customerPhone || 'N/A'}</p>
                        <p><strong>Time:</strong> ${new Date(order.createdAt).toLocaleString()}</p>
                    </div>
                    <div class="col-md-6">
                        <h6>Status</h6>
                        <div class="mb-3">
                            <span class="status-badge ${getStatusBadge(order.status)}">${order.status}</span>
                            <span class="badge ${order.paymentStatus === 'paid' ? 'bg-success' : 'bg-danger'} ms-2">${order.paymentStatus}</span>
                        </div>
                        <p><strong>Payment Method:</strong> ${order.paymentMethod || 'N/A'}</p>
                        <p><strong>Amount Paid:</strong> ${order.amountPaid ? `${restaurant.settings.currency}${order.amountPaid.toFixed(2)}` : 'N/A'}</p>
                        <p><strong>Change:</strong> ${order.change ? `${restaurant.settings.currency}${order.change.toFixed(2)}` : 'N/A'}</p>
                    </div>
                </div>
                
                <div class="mt-4">
                    <h6>Order Items</h6>
                    <div class="border rounded p-3 mb-3">
                        ${itemsHtml}
                    </div>
                </div>
                
                <div class="border-top pt-3">
                    <div class="d-flex justify-content-between">
                        <span>Subtotal:</span>
                        <span>${restaurant.settings.currency}${order.subtotal.toFixed(2)}</span>
                    </div>
                    <div class="d-flex justify-content-between">
                        <span>Tax (${(restaurant.settings.taxRate * 100)}%):</span>
                        <span>${restaurant.settings.currency}${order.tax.toFixed(2)}</span>
                    </div>
                    <div class="d-flex justify-content-between">
                        <span>Service Charge (${(restaurant.settings.serviceCharge * 100)}%):</span>
                        <span>${restaurant.settings.currency}${order.serviceCharge.toFixed(2)}</span>
                    </div>
                    ${order.tip ? `
                    <div class="d-flex justify-content-between">
                        <span>Tip:</span>
                        <span>${restaurant.settings.currency}${order.tip.toFixed(2)}</span>
                    </div>
                    ` : ''}
                    <div class="d-flex justify-content-between fw-bold mt-2 pt-2 border-top">
                        <span>Total:</span>
                        <span>${restaurant.settings.currency}${order.total.toFixed(2)}</span>
                    </div>
                </div>
                
                <div class="mt-4 text-end">
                    <button class="btn btn-primary" onclick="printOrderReceipt(${order.id})">
                        <i class="fas fa-print me-2"></i> Print Receipt
                    </button>
                    <button class="btn btn-secondary" onclick="closeOrderDetailsModal()">
                        Close
                    </button>
                </div>
            `;
            
            document.getElementById('orderDetailsModal').classList.add('active');
        }

        function closeOrderDetailsModal() {
            document.getElementById('orderDetailsModal').classList.remove('active');
        }

        function updateOrderStatus(orderId, status) {
            const order = restaurant.orders.find(o => o.id === orderId);
            if (!order) return;
            
            order.status = status;
            
            if (status === 'completed') {
                order.completedAt = new Date().toISOString();
                
                // Free up table if occupied
                if (order.tableId) {
                    const table = restaurant.tables.find(t => t.id === order.tableId);
                    if (table) {
                        table.status = 'available';
                        table.customerName = '';
                        table.orderId = null;
                    }
                }
            }
            
            saveData();
            updateOrdersTable();
            updateOrderCounts();
            updateDashboard();
            
            showToast(`Order ${order.orderNumber} marked as ${status}`, 'success');
        }

        function filterOrders(status) {
            // This would filter orders by status
            showToast(`Showing ${status} orders`, 'info');
        }

        function filterOrdersTable(searchTerm) {
            // This would implement search functionality
            console.log('Searching orders:', searchTerm);
        }

        // ========== MENU MANAGEMENT FUNCTIONS ==========
        function loadMenuManagement() {
            updateMenuTable();
        }

        function updateMenuTable() {
            const container = document.getElementById('menuTableBody');
            if (!container) return;
            
            let html = '';
            restaurant.menu.forEach(item => {
                const profit = item.price - (item.cost || 0);
                const profitMargin = item.cost ? ((profit / item.price) * 100).toFixed(1) : 'N/A';
                const statusBadge = item.available ? 'bg-success' : 'bg-danger';
                const statusText = item.available ? 'Available' : 'Unavailable';
                
                html += `
                    <tr>
                        <td>
                            <div class="menu-image-placeholder" style="width: 50px; height: 50px; background: #f0f0f0; border-radius: 5px; display: flex; align-items: center; justify-content: center;">
                                <i class="fas fa-utensils text-muted"></i>
                            </div>
                        </td>
                        <td>
                            <strong>${item.name}</strong>
                            <br><small class="text-muted">${item.description || 'No description'}</small>
                        </td>
                        <td><span class="badge bg-secondary">${item.category}</span></td>
                        <td><strong>${restaurant.settings.currency}${item.price.toFixed(2)}</strong></td>
                        <td>${item.cost ? `${restaurant.settings.currency}${item.cost.toFixed(2)}` : 'N/A'}</td>
                        <td>
                            ${item.cost ? `
                                <span class="badge ${profit > 0 ? 'bg-success' : 'bg-danger'}">
                                    ${restaurant.settings.currency}${profit.toFixed(2)} (${profitMargin}%)
                                </span>
                            ` : 'N/A'}
                        </td>
                        <td><span class="badge ${statusBadge}">${statusText}</span></td>
                        <td>
                            <div class="btn-group btn-group-sm">
                                <button class="btn btn-warning" onclick="editMenuItem(${item.id})">
                                    <i class="fas fa-edit"></i>
                                </button>
                                <button class="btn btn-danger" onclick="deleteMenuItem(${item.id})">
                                    <i class="fas fa-trash"></i>
                                </button>
                            </div>
                        </td>
                    </tr>
                `;
            });
            
            container.innerHTML = html;
        }

        function showAddItemModal() {
            document.getElementById('addItemModal').classList.add('active');
        }

        function closeAddItemModal() {
            document.getElementById('addItemModal').classList.remove('active');
            document.getElementById('addItemForm').reset();
        }

        function addMenuItem() {
            const newItem = {
                id: restaurant.menu.length + 1,
                name: document.getElementById('itemName').value,
                category: document.getElementById('itemCategory').value,
                price: parseFloat(document.getElementById('itemPrice').value),
                cost: parseFloat(document.getElementById('itemCost').value) || 0,
                description: document.getElementById('itemDescription').value,
                prepTime: parseInt(document.getElementById('prepTime').value) || 15,
                available: document.getElementById('itemAvailable').checked,
                image: null
            };
            
            restaurant.menu.push(newItem);
            saveData();
            updateMenuTable();
            
            if (currentSection === 'pos') {
                loadMenuItems();
            }
            
            closeAddItemModal();
            showToast('Menu item added successfully!', 'success');
        }

        function editMenuItem(itemId) {
            const item = restaurant.menu.find(m => m.id === itemId);
            if (!item) return;
            
            // Populate form and show modal
            document.getElementById('itemName').value = item.name;
            document.getElementById('itemCategory').value = item.category;
            document.getElementById('itemPrice').value = item.price;
            document.getElementById('itemCost').value = item.cost || '';
            document.getElementById('itemDescription').value = item.description || '';
            document.getElementById('prepTime').value = item.prepTime || 15;
            document.getElementById('itemAvailable').checked = item.available;
            
            // Change modal title
            document.querySelector('#addItemModal .modal-title').textContent = 'Edit Menu Item';
            
            // Change submit button behavior
            const form = document.getElementById('addItemForm');
            form.onsubmit = function(e) {
                e.preventDefault();
                updateMenuItem(itemId);
            };
            
            document.getElementById('addItemModal').classList.add('active');
        }

        function updateMenuItem(itemId) {
            const item = restaurant.menu.find(m => m.id === itemId);
            if (!item) return;
            
            item.name = document.getElementById('itemName').value;
            item.category = document.getElementById('itemCategory').value;
            item.price = parseFloat(document.getElementById('itemPrice').value);
            item.cost = parseFloat(document.getElementById('itemCost').value) || 0;
            item.description = document.getElementById('itemDescription').value;
            item.prepTime = parseInt(document.getElementById('prepTime').value) || 15;
            item.available = document.getElementById('itemAvailable').checked;
            
            saveData();
            updateMenuTable();
            
            if (currentSection === 'pos') {
                loadMenuItems();
            }
            
            closeAddItemModal();
            showToast('Menu item updated successfully!', 'success');
        }

        function deleteMenuItem(itemId) {
            Swal.fire({
                title: 'Delete Menu Item?',
                text: 'This action cannot be undone. Are you sure you want to delete this item?',
                icon: 'warning',
                showCancelButton: true,
                confirmButtonText: 'Yes, delete it!',
                cancelButtonText: 'Cancel',
                confirmButtonColor: '#d33'
            }).then((result) => {
                if (result.isConfirmed) {
                    restaurant.menu = restaurant.menu.filter(item => item.id !== itemId);
                    saveData();
                    updateMenuTable();
                    
                    if (currentSection === 'pos') {
                        loadMenuItems();
                    }
                    
                    showToast('Menu item deleted successfully', 'success');
                }
            });
        }

        function exportMenu() {
            const menuData = JSON.stringify(restaurant.menu, null, 2);
            const blob = new Blob([menuData], { type: 'application/json' });
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = `restaurant-menu-${new Date().toISOString().split('T')[0]}.json`;
            a.click();
            URL.revokeObjectURL(url);
            showToast('Menu exported successfully!', 'success');
        }

        // ========== INVENTORY FUNCTIONS ==========
        function loadInventory() {
            updateInventoryTable();
            updateLowStockAlerts();
        }

        function updateInventoryTable() {
            const container = document.getElementById('inventoryTableBody');
            if (!container) return;
            
            let html = '';
            restaurant.inventory.forEach(item => {
                const status = item.currentStock <= 0 ? 'Out of Stock' : 
                              item.currentStock <= item.minStock ? 'Low Stock' : 'In Stock';
                const statusClass = item.currentStock <= 0 ? 'bg-danger' : 
                                  item.currentStock <= item.minStock ? 'bg-warning' : 'bg-success';
                const totalValue = item.currentStock * item.costPerUnit;
                
                html += `
                    <tr>
                        <td><strong>${item.name}</strong></td>
                        <td><span class="badge bg-secondary">${item.category}</span></td>
                        <td>
                            <strong>${item.currentStock}</strong>
                            <div class="progress mt-1" style="height: 5px;">
                                <div class="progress-bar ${statusClass}" style="width: ${Math.min(100, (item.currentStock / (item.minStock * 2)) * 100)}%"></div>
                            </div>
                        </td>
                        <td>${item.minStock}</td>
                        <td>${item.unit}</td>
                        <td>${restaurant.settings.currency}${item.costPerUnit.toFixed(2)}</td>
                        <td>${restaurant.settings.currency}${totalValue.toFixed(2)}</td>
                        <td><span class="badge ${statusClass}">${status}</span></td>
                        <td>
                            <div class="btn-group btn-group-sm">
                                <button class="btn btn-warning" onclick="restockItem(${item.id})">
                                    <i class="fas fa-box"></i>
                                </button>
                                <button class="btn btn-info" onclick="editInventoryItem(${item.id})">
                                    <i class="fas fa-edit"></i>
                                </button>
                            </div>
                        </td>
                    </tr>
                `;
            });
            
            container.innerHTML = html;
            
            // Update inventory summary
            const totalItems = restaurant.inventory.length;
            const lowStock = restaurant.inventory.filter(i => i.currentStock <= i.minStock && i.currentStock > 0).length;
            const outOfStock = restaurant.inventory.filter(i => i.currentStock <= 0).length;
            const inventoryValue = restaurant.inventory.reduce((sum, item) => sum + (item.currentStock * item.costPerUnit), 0);
            
            document.getElementById('totalInventoryItems').textContent = totalItems;
            document.getElementById('lowStockCount').textContent = lowStock;
            document.getElementById('outOfStockCount').textContent = outOfStock;
            document.getElementById('inventoryValue').textContent = `${restaurant.settings.currency}${inventoryValue.toFixed(2)}`;
        }

        function updateLowStockAlerts() {
            const container = document.getElementById('lowStockItems');
            if (!container) return;
            
            const lowStockItems = restaurant.inventory.filter(item => 
                item.currentStock <= item.minStock
            ).slice(0, 5);
            
            if (lowStockItems.length === 0) {
                container.innerHTML = `
                    <div class="text-center text-muted py-3">
                        <i class="fas fa-check-circle fa-2x mb-2"></i>
                        <p>All items are well stocked</p>
                    </div>
                `;
                return;
            }
            
            let html = '';
            lowStockItems.forEach(item => {
                const status = item.currentStock <= 0 ? 'Out of Stock' : 'Low Stock';
                const statusClass = item.currentStock <= 0 ? 'text-danger' : 'text-warning';
                
                html += `
                    <div class="alert ${statusClass} alert-sm d-flex justify-content-between align-items-center mb-2">
                        <div>
                            <strong>${item.name}</strong>
                            <br><small>Current: ${item.currentStock} ${item.unit} | Min: ${item.minStock} ${item.unit}</small>
                        </div>
                        <button class="btn btn-sm btn-outline-${item.currentStock <= 0 ? 'danger' : 'warning'}" onclick="restockItem(${item.id})">
                            <i class="fas fa-shopping-cart"></i>
                        </button>
                    </div>
                `;
            });
            
            container.innerHTML = html;
        }

        function showAddInventoryItemModal() {
            // This would show a modal to add inventory items
            showToast('Add inventory item feature coming soon!', 'info');
        }

        function showReorderModal() {
            const lowStockItems = restaurant.inventory.filter(item => item.currentStock <= item.minStock);
            
            if (lowStockItems.length === 0) {
                showToast('No items need reordering', 'info');
                return;
            }
            
            let itemsList = '';
            lowStockItems.forEach(item => {
                itemsList += `
                    <div class="d-flex justify-content-between mb-2">
                        <div>
                            <strong>${item.name}</strong>
                            <br><small>Current: ${item.currentStock} ${item.unit} | Min: ${item.minStock} ${item.unit}</small>
                        </div>
                        <input type="number" class="form-control form-control-sm" style="width: 80px;" 
                               value="${item.minStock * 2}" min="${item.minStock + 1}">
                    </div>
                `;
            });
            
            Swal.fire({
                title: 'Reorder Items',
                html: `
                    <div class="text-start">
                        <p class="text-muted">The following items need reordering:</p>
                        ${itemsList}
                    </div>
                `,
                showCancelButton: true,
                confirmButtonText: 'Place Order',
                cancelButtonText: 'Cancel'
            }).then((result) => {
                if (result.isConfirmed) {
                    // Here you would implement the reorder logic
                    showToast('Reorder placed successfully!', 'success');
                }
            });
        }

        function restockItem(itemId) {
            const item = restaurant.inventory.find(i => i.id === itemId);
            if (!item) return;
            
            Swal.fire({
                title: `Restock ${item.name}`,
                html: `
                    <div class="text-start">
                        <p>Current Stock: <strong>${item.currentStock} ${item.unit}</strong></p>
                        <p>Minimum Stock: <strong>${item.minStock} ${item.unit}</strong></p>
                        <div class="mb-3">
                            <label class="form-label">Add Quantity</label>
                            <input type="number" class="form-control" id="restockQuantity" 
                                   value="${item.minStock * 2}" min="1">
                        </div>
                        <div class="mb-3">
                            <label class="form-label">Unit Cost</label>
                            <input type="number" class="form-control" id="restockCost" 
                                   value="${item.costPerUnit.toFixed(2)}" step="0.01" min="0">
                        </div>
                    </div>
                `,
                showCancelButton: true,
                confirmButtonText: 'Restock',
                cancelButtonText: 'Cancel',
                preConfirm: () => {
                    return {
                        quantity: parseInt(document.getElementById('restockQuantity').value),
                        cost: parseFloat(document.getElementById('restockCost').value)
                    };
                }
            }).then((result) => {
                if (result.isConfirmed) {
                    item.currentStock += result.value.quantity;
                    item.costPerUnit = result.value.cost;
                    item.lastRestocked = new Date().toISOString();
                    
                    saveData();
                    loadInventory();
                    showToast(`${item.name} restocked successfully!`, 'success');
                }
            });
        }

        // ========== STAFF FUNCTIONS ==========
        function loadStaff() {
            updateStaffTable();
            updateStaffStatistics();
        }

        function updateStaffTable() {
            const container = document.getElementById('staffTableBody');
            if (!container) return;
            
            let html = '';
            restaurant.staff.forEach(staff => {
                const statusBadge = staff.status === 'active' ? 'bg-success' : 
                                  staff.status === 'on leave' ? 'bg-warning' : 'bg-secondary';
                const ratingStars = '‚òÖ'.repeat(Math.floor(staff.rating)) + '‚òÜ'.repeat(5 - Math.floor(staff.rating));
                
                html += `
                    <tr>
                        <td>
                            <strong>${staff.name}</strong>
                            <br><small class="text-muted">${staff.email}</small>
                        </td>
                        <td><span class="badge bg-info">${staff.role}</span></td>
                        <td>${staff.phone}</td>
                        <td><span class="badge bg-secondary">${staff.shift}</span></td>
                        <td><span class="badge ${statusBadge}">${staff.status}</span></td>
                        <td>
                            <div class="text-warning">${ratingStars}</div>
                            <small class="text-muted">${staff.rating.toFixed(1)}</small>
                        </td>
                        <td>
                            <div class="btn-group btn-group-sm">
                                <button class="btn btn-warning" onclick="editStaff(${staff.id})">
                                    <i class="fas fa-edit"></i>
                                </button>
                                <button class="btn btn-info" onclick="viewStaffSchedule(${staff.id})">
                                    <i class="fas fa-calendar"></i>
                                </button>
                            </div>
                        </td>
                    </tr>
                `;
            });
            
            container.innerHTML = html;
        }

        function updateStaffStatistics() {
            const totalStaff = restaurant.staff.length;
            const activeStaff = restaurant.staff.filter(s => s.status === 'active').length;
            const onLeave = restaurant.staff.filter(s => s.status === 'on leave').length;
            const averageRating = restaurant.staff.length > 0 ? 
                restaurant.staff.reduce((sum, s) => sum + s.rating, 0) / restaurant.staff.length : 0;
            
            document.getElementById('totalStaffCount').textContent = totalStaff;
            document.getElementById('activeStaffCount').textContent = activeStaff;
            document.getElementById('onLeaveCount').textContent = onLeave;
            document.getElementById('averageRating').textContent = averageRating.toFixed(1);
            
            // Update today's shift
            const todayShift = restaurant.staff.filter(s => s.status === 'active').slice(0, 3);
            const container = document.getElementById('todayShift');
            
            if (todayShift.length === 0) {
                container.innerHTML = '<p class="text-muted">No staff scheduled today</p>';
                return;
            }
            
            let html = '';
            todayShift.forEach(staff => {
                html += `
                    <div class="d-flex justify-content-between align-items-center mb-2">
                        <div>
                            <strong>${staff.name}</strong>
                            <br><small class="text-muted">${staff.role} ‚Ä¢ ${staff.shift} shift</small>
                        </div>
                        <span class="badge bg-success">On Duty</span>
                    </div>
                `;
            });
            
            container.innerHTML = html;
        }

        function showAddStaffModal() {
            showToast('Add staff feature coming soon!', 'info');
        }

        function showScheduleModal() {
            showToast('Schedule view feature coming soon!', 'info');
        }

        // ========== CUSTOMER FUNCTIONS ==========
        function loadCustomers() {
            updateCustomersTable();
            updateCustomerStatistics();
        }

        function updateCustomersTable() {
            const container = document.getElementById('customersTableBody');
            if (!container) return;
            
            let html = '';
            restaurant.customers.forEach(customer => {
                const lastVisit = customer.lastVisit ? new Date(customer.lastVisit).toLocaleDateString() : 'Never';
                
                html += `
                    <tr>
                        <td><strong>${customer.name}</strong></td>
                        <td>${customer.phone}</td>
                        <td>${customer.email || 'N/A'}</td>
                        <td>${customer.totalVisits}</td>
                        <td><strong>${restaurant.settings.currency}${customer.totalSpent.toFixed(2)}</strong></td>
                        <td>${lastVisit}</td>
                        <td>
                            <span class="badge bg-warning">
                                <i class="fas fa-star me-1"></i>${customer.loyaltyPoints}
                            </span>
                        </td>
                        <td>
                            <div class="btn-group btn-group-sm">
                                <button class="btn btn-info" onclick="viewCustomerDetails(${customer.id})">
                                    <i class="fas fa-eye"></i>
                                </button>
                                <button class="btn btn-warning" onclick="editCustomer(${customer.id})">
                                    <i class="fas fa-edit"></i>
                                </button>
                            </div>
                        </td>
                    </tr>
                `;
            });
            
            container.innerHTML = html;
        }

        function updateCustomerStatistics() {
            const totalCustomers = restaurant.customers.length;
            const activeCustomers = restaurant.customers.filter(c => {
                const lastVisit = new Date(c.lastVisit);
                const thirtyDaysAgo = new Date();
                thirtyDaysAgo.setDate(thirtyDaysAgo.getDate() - 30);
                return lastVisit >= thirtyDaysAgo;
            }).length;
            const loyaltyMembers = restaurant.customers.filter(c => c.loyaltyPoints > 0).length;
            
            // Calculate average visit frequency
            let totalDays = 0;
            let count = 0;
            restaurant.customers.forEach(customer => {
                if (customer.totalVisits > 1) {
                    // Simplified calculation
                    totalDays += 30 / customer.totalVisits;
                    count++;
                }
            });
            const avgFrequency = count > 0 ? Math.round(totalDays / count) : 0;
            
            document.getElementById('totalCustomers').textContent = totalCustomers;
            document.getElementById('activeCustomers').textContent = activeCustomers;
            document.getElementById('loyaltyMembers').textContent = loyaltyMembers;
            document.getElementById('avgVisitFrequency').textContent = `${avgFrequency} days`;
            
            // Update top customers
            const topCustomers = [...restaurant.customers]
                .sort((a, b) => b.totalSpent - a.totalSpent)
                .slice(0, 3);
            
            const container = document.getElementById('topCustomers');
            if (topCustomers.length === 0) {
                container.innerHTML = '<p class="text-muted">No customer data</p>';
                return;
            }
            
            let html = '';
            topCustomers.forEach(customer => {
                html += `
                    <div class="d-flex justify-content-between align-items-center mb-2">
                        <div>
                            <strong>${customer.name}</strong>
                            <br><small class="text-muted">${customer.totalVisits} visits</small>
                        </div>
                        <div class="text-end">
                            <strong>${restaurant.settings.currency}${customer.totalSpent.toFixed(2)}</strong>
                            <br><small class="text-warning"><i class="fas fa-star"></i> ${customer.loyaltyPoints}</small>
                        </div>
                    </div>
                `;
            });
            
            container.innerHTML = html;
        }

        function showAddCustomerModal() {
            showToast('Add customer feature coming soon!', 'info');
        }

        function exportCustomers() {
            showToast('Export customers feature coming soon!', 'info');
        }

        // ========== REPORTS FUNCTIONS ==========
        function loadReports() {
            updateReportCharts();
            updateReportStats();
        }

        function updateReportCharts() {
            // Sales Chart
            const salesCtx = document.getElementById('salesChart')?.getContext('2d');
            if (salesCtx) {
                if (salesChart) salesChart.destroy();
                
                const last7Days = getLast7Days();
                const dailySales = last7Days.map(day => 
                    getOrdersForDate(day).reduce((sum, order) => sum + order.total, 0)
                );
                
                salesChart = new Chart(salesCtx, {
                    type: 'bar',
                    data: {
                        labels: last7Days.map(d => d.toLocaleDateString('en-US', { weekday: 'short' })),
                        datasets: [{
                            label: 'Daily Sales',
                            data: dailySales,
                            backgroundColor: 'rgba(67, 97, 238, 0.5)',
                            borderColor: '#4361ee',
                            borderWidth: 1
                        }]
                    },
                    options: {
                        responsive: true,
                        plugins: {
                            legend: {
                                display: false
                            }
                        }
                    }
                });
            }
            
            // Revenue Chart
            const revenueCtx = document.getElementById('revenueChart')?.getContext('2d');
            if (revenueCtx) {
                if (revenueChart) revenueChart.destroy();
                
                const categories = ['Food', 'Drinks', 'Desserts', 'Other'];
                const revenueData = categories.map(category => 
                    getTodayOrders().reduce((sum, order) => {
                        const categoryTotal = order.items.reduce((itemSum, item) => {
                            const itemCategory = restaurant.menu.find(m => m.name === item.name)?.category;
                            return itemCategory === category ? itemSum + (item.price * item.quantity) : itemSum;
                        }, 0);
                        return sum + categoryTotal;
                    }, 0)
                );
                
                revenueChart = new Chart(revenueCtx, {
                    type: 'pie',
                    data: {
                        labels: categories,
                        datasets: [{
                            data: revenueData,
                            backgroundColor: ['#4361ee', '#4cc9f0', '#f8961e', '#7209b7']
                        }]
                    },
                    options: {
                        responsive: true,
                        plugins: {
                            legend: {
                                position: 'bottom'
                            }
                        }
                    }
                });
            }
        }

        function updateReportStats() {
            const todaySales = getTodayOrders().reduce((sum, order) => sum + order.total, 0);
            const yesterdaySales = getOrdersForDate(new Date(new Date().setDate(new Date().getDate() - 1)))
                .reduce((sum, order) => sum + order.total, 0);
            const weeklyGrowth = yesterdaySales > 0 ? 
                ((todaySales - yesterdaySales) / yesterdaySales * 100).toFixed(1) : 0;
            
            document.getElementById('dailySales').textContent = `${restaurant.settings.currency}${todaySales.toFixed(2)}`;
            document.getElementById('weeklyGrowth').textContent = `${weeklyGrowth}%`;
        }

        function generateDailyReport() {
            const today = new Date();
            const todayOrders = getTodayOrders();
            const totalRevenue = todayOrders.reduce((sum, order) => sum + order.total, 0);
            const totalOrders = todayOrders.length;
            const uniqueCustomers = new Set(todayOrders.map(o => o.customerPhone)).size;
            
            let report = `
                DAILY RESTAURANT REPORT
                Restaurant: ${restaurant.settings.restaurantName}
                Date: ${today.toLocaleDateString()}
                Time: ${today.toLocaleTimeString()}
                =================================
                
                SUMMARY:
                Total Orders: ${totalOrders}
                Total Revenue: ${restaurant.settings.currency}${totalRevenue.toFixed(2)}
                Unique Customers: ${uniqueCustomers}
                Average Order Value: ${restaurant.settings.currency}${(totalRevenue / totalOrders).toFixed(2)}
                
                =================================
                ORDER DETAILS:
            `;
            
            todayOrders.forEach(order => {
                report += `
                ${order.orderNumber} - ${order.customerName}
                Table: ${order.tableId ? order.tableId : 'Takeaway'}
                Items: ${order.items.length}
                Total: ${restaurant.settings.currency}${order.total.toFixed(2)}
                Status: ${order.status}
                Payment: ${order.paymentStatus}
                ---------------------------------
                `;
            });
            
            const printWindow = window.open('', '_blank');
            printWindow.document.write(`
                <html>
                <head>
                    <title>Daily Report - ${today.toLocaleDateString()}</title>
                    <style>
                        body { font-family: monospace; padding: 20px; }
                        pre { white-space: pre-wrap; }
                        @media print {
                            body { margin: 0; }
                        }
                    </style>
                </head>
                <body>
                    <pre>${report}</pre>
                    <script>
                        window.onload = function() {
                            window.print();
                            setTimeout(function() {
                                window.close();
                            }, 1000);
                        }
                    <\/script>
                </body>
                </html>
            `);
            
            showToast('Daily report generated!', 'success');
        }

        function generateWeeklyReport() {
            showToast('Weekly report feature coming soon!', 'info');
        }

        function generateMonthlyReport() {
            showToast('Monthly report feature coming soon!', 'info');
        }

        function exportPDF(type) {
            showToast('PDF export feature coming soon!', 'info');
        }

        function exportExcel(type) {
            showToast('Excel export feature coming soon!', 'info');
        }

        function printSalesReport() {
            showToast('Print sales report feature coming soon!', 'info');
        }

        function showDetailedAnalytics() {
            showToast('Detailed analytics feature coming soon!', 'info');
        }

        // ========== SETTINGS FUNCTIONS ==========
        function loadSettings() {
            // Populate settings form with current values
            document.getElementById('restaurantName').value = restaurant.settings.restaurantName;
            document.getElementById('currency').value = restaurant.settings.currency;
            document.getElementById('timezone').value = restaurant.settings.timezone;
            document.getElementById('language').value = restaurant.settings.language;
            document.getElementById('dateFormat').value = restaurant.settings.dateFormat;
            document.getElementById('autoLogout').value = 30;
            
            // Tax settings
            document.getElementById('taxRateInput').value = restaurant.settings.taxRate * 100;
            document.getElementById('serviceChargeInput').value = restaurant.settings.serviceCharge * 100;
            document.getElementById('enableTip').checked = restaurant.settings.enableTip;
            document.getElementById('defaultTip').value = restaurant.settings.defaultTip * 100;
            document.getElementById('defaultTip').disabled = !restaurant.settings.enableTip;
            
            // Print settings
            document.getElementById('receiptHeader').value = 'Thank you for dining with us!';
            document.getElementById('receiptFooter').value = 'Please visit us again!';
            document.getElementById('printReceipt').checked = restaurant.settings.autoPrint;
            document.getElementById('printKitchen').checked = restaurant.settings.autoPrint;
            
            // Backup settings
            document.getElementById('autoBackup').checked = restaurant.settings.autoBackup;
            document.getElementById('backupFrequency').value = 'daily';
        }

        function saveSettings() {
            // Save general settings
            restaurant.settings.restaurantName = document.getElementById('restaurantName').value;
            restaurant.settings.currency = document.getElementById('currency').value;
            restaurant.settings.timezone = document.getElementById('timezone').value;
            restaurant.settings.language = document.getElementById('language').value;
            restaurant.settings.dateFormat = document.getElementById('dateFormat').value;
            
            // Save tax settings
            restaurant.settings.taxRate = parseFloat(document.getElementById('taxRateInput').value) / 100;
            restaurant.settings.serviceCharge = parseFloat(document.getElementById('serviceChargeInput').value) / 100;
            restaurant.settings.enableTip = document.getElementById('enableTip').checked;
            restaurant.settings.defaultTip = parseFloat(document.getElementById('defaultTip').value) / 100;
            
            // Save print settings
            restaurant.settings.autoPrint = document.getElementById('printReceipt').checked;
            
            // Save backup settings
            restaurant.settings.autoBackup = document.getElementById('autoBackup').checked;
            
            saveData();
            showToast('Settings saved successfully!', 'success');
            
            // Update UI to reflect new settings
            updateDashboard();
        }

        function exportAllData() {
            const data = {
                restaurant: restaurant,
                exportedAt: new Date().toISOString(),
                version: restaurant.system.version
            };
            
            const dataStr = JSON.stringify(data, null, 2);
            const blob = new Blob([dataStr], { type: 'application/json' });
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = `restaurantos-backup-${new Date().toISOString().split('T')[0]}.json`;
            a.click();
            URL.revokeObjectURL(url);
            showToast('All data exported successfully!', 'success');
        }

        function importData() {
            const input = document.createElement('input');
            input.type = 'file';
            input.accept = '.json';
            
            input.onchange = e => {
                const file = e.target.files[0];
                const reader = new FileReader();
                
                reader.onload = event => {
                    try {
                        const data = JSON.parse(event.target.result);
                        
                        Swal.fire({
                            title: 'Import Data?',
                            text: 'This will replace all current data. Are you sure?',
                            icon: 'warning',
                            showCancelButton: true,
                            confirmButtonText: 'Yes, import',
                            cancelButtonText: 'Cancel',
                            confirmButtonColor: '#d33'
                        }).then((result) => {
                            if (result.isConfirmed) {
                                restaurant = data.restaurant;
                                saveData();
                                location.reload();
                            }
                        });
                        
                    } catch (error) {
                        showToast('Invalid backup file', 'error');
                    }
                };
                
                reader.readAsText(file);
            };
            
            input.click();
        }

        function resetSystem() {
            Swal.fire({
                title: 'Reset System?',
                text: 'This will delete all data and restore default settings. This action cannot be undone!',
                icon: 'warning',
                showCancelButton: true,
                confirmButtonText: 'Yes, reset system',
                cancelButtonText: 'Cancel',
                confirmButtonColor: '#d33'
            }).then((result) => {
                if (result.isConfirmed) {
                    localStorage.removeItem('restaurantOSData');
                    location.reload();
                }
            });
        }

        // ========== UTILITY FUNCTIONS ==========
        function getTodayOrders() {
            const today = new Date().toDateString();
            return restaurant.orders.filter(order => 
                new Date(order.createdAt).toDateString() === today
            );
        }

        function getOrdersForDate(date) {
            const targetDate = new Date(date).toDateString();
            return restaurant.orders.filter(order => 
                new Date(order.createdAt).toDateString() === targetDate
            );
        }

        function getLast7Days() {
            const days = [];
            for (let i = 6; i >= 0; i--) {
                const date = new Date();
                date.setDate(date.getDate() - i);
                days.push(date);
            }
            return days;
        }

        function formatTime(dateString) {
            if (!dateString) return 'Never';
            const date = new Date(dateString);
            return date.toLocaleTimeString([], {hour: '2-digit', minute:'2-digit'});
        }

        function initializeClock() {
            function updateClocks() {
                const now = new Date();
                const timeString = now.toLocaleTimeString([], {hour: '2-digit', minute:'2-digit', second:'2-digit'});
                const dateString = now.toLocaleDateString([], {weekday: 'long', year: 'numeric', month: 'long', day: 'numeric'});
                
                document.getElementById('currentDate').textContent = dateString;
                document.getElementById('systemTime').textContent = timeString;
            }
            
            updateClocks();
            setInterval(updateClocks, 1000);
        }

        function saveData() {
            restaurant.system.lastBackup = new Date().toISOString();
            localStorage.setItem('restaurantOSData', JSON.stringify(restaurant));
        }

        function showToast(message, type = 'info') {
            const container = document.getElementById('toastContainer');
            if (!container) return;
            
            const toast = document.createElement('div');
            toast.className = `custom-toast toast-${type}`;
            
            const icons = {
                success: 'fa-check-circle',
                error: 'fa-times-circle',
                warning: 'fa-exclamation-triangle',
                info: 'fa-info-circle'
            };
            
            toast.innerHTML = `
                <div class="toast-icon">
                    <i class="fas ${icons[type]}"></i>
                </div>
                <div class="flex-grow-1">
                    <strong>${type.charAt(0).toUpperCase() + type.slice(1)}</strong>
                    <div class="small">${message}</div>
                </div>
                <button type="button" class="btn-close" onclick="this.parentElement.remove()"></button>
            `;
            
            container.appendChild(toast);
            
            // Auto-remove after 5 seconds
            setTimeout(() => {
                if (toast.parentElement) {
                    toast.remove();
                }
            }, 5000);
        }

        function printKitchenTicket(order) {
            let ticket = `
                KITCHEN ORDER TICKET
                =================================
                Order: ${order.orderNumber}
                Table: ${order.tableId ? `Table ${order.tableId}` : 'Takeaway'}
                Customer: ${order.customerName}
                Time: ${new Date(order.createdAt).toLocaleTimeString()}
                =================================
                
                ITEMS:
            `;
            
            order.items.forEach(item => {
                ticket += `
                ${item.quantity}x ${item.name}
                `;
            });
            
            ticket += `
                =================================
                Special Instructions: ${order.notes || 'None'}
                =================================
                Ticket printed at: ${new Date().toLocaleTimeString()}
            `;
            
            console.log('KITCHEN TICKET PRINTED:\n', ticket);
            
            // In a real system, this would send to kitchen printer
            // For now, show a notification
            showToast('Kitchen ticket printed', 'info');
        }

        function printReceipt(order, amountPaid, change, tip = 0) {
            let receipt = `
                ${restaurant.settings.restaurantName}
                =================================
                Order: ${order.orderNumber}
                Date: ${new Date().toLocaleDateString()}
                Time: ${new Date().toLocaleTimeString()}
                Customer: ${order.customerName}
                Table: ${order.tableId ? `Table ${order.tableId}` : 'Takeaway'}
                =================================
                
                ITEMS:
            `;
            
            order.items.forEach(item => {
                const itemTotal = item.price * item.quantity;
                receipt += `
                ${item.name}
                ${item.quantity} x ${restaurant.settings.currency}${item.price.toFixed(2)} = ${restaurant.settings.currency}${itemTotal.toFixed(2)}
                `;
            });
            
            receipt += `
                =================================
                Subtotal:        ${restaurant.settings.currency}${order.subtotal.toFixed(2)}
                Tax (${(restaurant.settings.taxRate * 100)}%):      ${restaurant.settings.currency}${order.tax.toFixed(2)}
                Service (${(restaurant.settings.serviceCharge * 100)}%): ${restaurant.settings.currency}${order.serviceCharge.toFixed(2)}
            `;
            
            if (tip > 0) {
                receipt += `
                Tip:             ${restaurant.settings.currency}${tip.toFixed(2)}
                `;
            }
            
            receipt += `
                ---------------------------------
                TOTAL:           ${restaurant.settings.currency}${(order.total + tip).toFixed(2)}
                
                Payment Method:  ${order.paymentMethod.toUpperCase()}
                Amount Paid:     ${restaurant.settings.currency}${amountPaid.toFixed(2)}
                Change:          ${restaurant.settings.currency}${change.toFixed(2)}
                
                =================================
                ${restaurant.settings.receiptFooter || 'Thank you for your visit!'}
                =================================
            `;
            
            // Open print window
            if (restaurant.settings.autoPrint) {
                const printWindow = window.open('', '_blank');
                printWindow.document.write(`
                    <html>
                    <head>
                        <title>Receipt - ${order.orderNumber}</title>
                        <style>
                            body { font-family: monospace; padding: 20px; font-size: 14px; }
                            pre { white-space: pre-wrap; }
                            @media print {
                                body { margin: 0; }
                                @page { margin: 0; }
                            }
                        </style>
                    </head>
                    <body>
                        <pre>${receipt}</pre>
                        <script>
                            window.onload = function() {
                                window.print();
                                setTimeout(function() {
                                    window.close();
                                }, 1000);
                            }
                        <\/script>
                    </body>
                    </html>
                `);
            }
            
            showToast('Receipt printed', 'success');
        }

        function printOrderReceipt(orderId) {
            const order = restaurant.orders.find(o => o.id === orderId);
            if (order) {
                printReceipt(order, order.amountPaid || order.total, order.change || 0, order.tip || 0);
            }
        }

        // ========== SYSTEM FUNCTIONS ==========
        function checkSystemStatus() {
            // Check if system is running properly
            const status = 'All Systems Operational';
            document.getElementById('systemStatus').textContent = status;
        }

        // Initialize system status check
        setInterval(checkSystemStatus, 60000); // Check every minute
        checkSystemStatus();

        // Auto-save every 5 minutes if enabled
        if (restaurant.settings.autoBackup) {
            setInterval(saveData, 300000);
        }

        // Initialize tooltips
        const tooltipTriggerList = [].slice.call(document.querySelectorAll('[data-bs-toggle="tooltip"]'));
        tooltipTriggerList.map(function (tooltipTriggerEl) {
            return new bootstrap.Tooltip(tooltipTriggerEl);
        });
    </script>
</body>
</html>